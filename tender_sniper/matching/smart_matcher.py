"""
Smart Matching Engine –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–µ–Ω–¥–µ—Ä–æ–≤ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç scoring –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–Ω–¥–µ—Ä–æ–≤ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏.
"""

import re
import json
from typing import List, Dict, Any, Optional, Set
from datetime import datetime, timedelta
import logging

logger = logging.getLogger(__name__)


def detect_red_flags(tender: Dict[str, Any]) -> List[str]:
    """
    –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏) –≤ —Ç–µ–Ω–¥–µ—Ä–µ.

    Args:
        tender: –î–∞–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ—Ä–∞

    Returns:
        –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
    """
    flags = []

    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏
    deadline = tender.get('submission_deadline') or tender.get('deadline')
    if deadline:
        try:
            if isinstance(deadline, str):
                # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç—ã
                for fmt in ['%Y-%m-%d', '%d.%m.%Y', '%Y-%m-%dT%H:%M:%S', '%d.%m.%Y %H:%M']:
                    try:
                        deadline_dt = datetime.strptime(deadline.split('+')[0].split('Z')[0], fmt)
                        break
                    except ValueError:
                        continue
                else:
                    deadline_dt = None
            else:
                deadline_dt = deadline

            if deadline_dt:
                days_left = (deadline_dt - datetime.now()).days
                if days_left < 0:
                    flags.append("‚õî –°—Ä–æ–∫ –ø–æ–¥–∞—á–∏ –∏—Å—Ç—ë–∫")
                elif days_left <= 3:
                    flags.append("üî¥ –°—Ä–æ–∫ –ø–æ–¥–∞—á–∏ –º–µ–Ω–µ–µ 3 –¥–Ω–µ–π")
                elif days_left <= 5:
                    flags.append("‚ö†Ô∏è –°—Ä–æ–∫ –ø–æ–¥–∞—á–∏ –º–µ–Ω–µ–µ 5 –¥–Ω–µ–π")
        except Exception:
            pass

    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ –≤ —Ç–µ–∫—Å—Ç–µ
    text = (tender.get('name', '') + ' ' + (tender.get('description', '') or '')).lower()

    # –õ–∏—Ü–µ–Ω–∑–∏–∏ –§–°–ë/–§–°–¢–≠–ö (–≥–æ—Å—Ç–∞–π–Ω–∞, –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è)
    fsb_patterns = ['–ª–∏—Ü–µ–Ω–∑–∏—è —Ñ—Å–±', '–ª–∏—Ü–µ–Ω–∑–∏–∏ —Ñ—Å–±', '—Ñ—Å–± —Ä–æ—Å—Å–∏–∏', '–≥–æ—Å—Ç–∞–π–Ω–∞', '–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–∞–π–Ω–∞',
                    '—Å–µ–∫—Ä–µ—Ç–Ω–æ', '—Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —Å–µ–∫—Ä–µ—Ç–Ω–æ', '–æ—Å–æ–±–æ–π –≤–∞–∂–Ω–æ—Å—Ç–∏']
    for pattern in fsb_patterns:
        if pattern in text:
            flags.append("üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏—Ü–µ–Ω–∑–∏—è –§–°–ë (–≥–æ—Å—Ç–∞–π–Ω–∞)")
            break

    fstec_patterns = ['–ª–∏—Ü–µ–Ω–∑–∏—è —Ñ—Å—Ç—ç–∫', '–ª–∏—Ü–µ–Ω–∑–∏–∏ —Ñ—Å—Ç—ç–∫', '—Ñ—Å—Ç—ç–∫ —Ä–æ—Å—Å–∏–∏', '–∑–∞—â–∏—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏',
                      '—Å—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏', '—Å–∑–∏']
    for pattern in fstec_patterns:
        if pattern in text:
            flags.append("üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏—Ü–µ–Ω–∑–∏—è –§–°–¢–≠–ö")
            break

    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω–∏–∑–∫—É—é —Ü–µ–Ω—É
    price = tender.get('price')
    if price and price > 0:
        # –ï—Å–ª–∏ —Ü–µ–Ω–∞ –º–µ–Ω—å—à–µ 100 000 —Ä—É–±–ª–µ–π –¥–ª—è —Ç–µ–Ω–¥–µ—Ä–∞ - –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω–∏–∑–∫–∞—è
        if price < 100000:
            flags.append("üí∞ –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è –Ω–∞—á–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞")

    # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏/–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
    if '–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏' in text or '–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è' in text:
        # –ò—â–µ–º –±–æ–ª—å—à–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è (>10%)
        percent_matches = re.findall(r'(\d+)\s*%\s*(?:–æ—Ç\s+)?(?:–Ω–º—Ü–∫|—Ü–µ–Ω—ã|–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞|–æ–±–µ—Å–ø–µ—á–µ–Ω)', text)
        for match in percent_matches:
            if int(match) > 10:
                flags.append(f"üí≥ –í—ã—Å–æ–∫–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ ({match}%)")
                break

    # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
    if '–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω' in text and ('–ø–æ—Å—Ç–∞–≤—â–∏–∫' in text or '–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª' in text or '–ø–æ–¥—Ä—è–¥—á–∏–∫' in text):
        flags.append("üë§ –ó–∞–∫—É–ø–∫–∞ —É –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞")

    # 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—Ä–æ—á–Ω—É—é –∑–∞–∫—É–ø–∫—É
    urgent_patterns = ['—Å—Ä–æ—á–Ω–∞—è –∑–∞–∫—É–ø–∫–∞', '—Å—Ä–æ—á–Ω—ã–π –∑–∞–∫–∞–∑', '—ç–∫—Å—Ç—Ä–µ–Ω–Ω', '–±–µ–∑–æ—Ç–ª–∞–≥–∞—Ç–µ–ª—å–Ω', '–Ω–µ–æ—Ç–ª–æ–∂–Ω']
    for pattern in urgent_patterns:
        if pattern in text:
            flags.append("‚è∞ –°—Ä–æ—á–Ω–∞—è/—ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –∑–∞–∫—É–ø–∫–∞")
            break

    # 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
    specific_patterns = [
        ('—á–ª–µ–Ω—Å—Ç–≤–æ –≤ —Å—Ä–æ', 'üìú –¢—Ä–µ–±—É–µ—Ç—Å—è —á–ª–µ–Ω—Å—Ç–≤–æ –≤ –°–†–û'),
        ('–æ–ø—ã—Ç –Ω–µ –º–µ–Ω–µ–µ 3 –ª–µ—Ç', 'üìã –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—ã—Ç –æ—Ç 3 –ª–µ—Ç'),
        ('–æ–ø—ã—Ç –Ω–µ –º–µ–Ω–µ–µ 5 –ª–µ—Ç', 'üìã –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—ã—Ç –æ—Ç 5 –ª–µ—Ç'),
        ('–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–ª', 'üë• –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞'),
        ('–∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è', 'üìú –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è'),
    ]
    for pattern, flag_text in specific_patterns:
        if pattern in text:
            flags.append(flag_text)

    # 8. –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–∞—Ä–∫–∏/–±—Ä–µ–Ω–¥–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏)
    brand_patterns = [
        r'(?:—Ç–æ–≤–∞—Ä–Ω—ã–π –∑–Ω–∞–∫|—Ç–æ—Ä–≥–æ–≤–∞—è –º–∞—Ä–∫–∞|–∫–æ–Ω–∫—Ä–µ—Ç–Ω\w+ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª)',
        r'—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç\w* –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è',
    ]
    for bp in brand_patterns:
        if re.search(bp, text):
            flags.append("üè∑Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–∞—Ä–∫–∏/–±—Ä–µ–Ω–¥–∞")
            break

    # 9. –ê—É–∫—Ü–∏–æ–Ω —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —É—á–∞—Å—Ç–∏–µ–º
    if '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω' in text and ('—É—á–∞—Å—Ç–∏' in text or '–∞—É–∫—Ü–∏–æ–Ω' in text):
        flags.append("üö´ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —É—á–∞—Å—Ç–∏–µ")

    # 10. –ó–∞–ø—Ä–µ—Ç —Å—É–±–ø–æ–¥—Ä—è–¥–∞
    if ('—Å—É–±–ø–æ–¥—Ä—è–¥' in text or '—Å—É–±–ø–æ–¥—Ä—è–¥—á–∏–∫' in text) and ('–∑–∞–ø—Ä–µ—â' in text or '–Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è' in text):
        flags.append("üîó –°—É–±–ø–æ–¥—Ä—è–¥ –∑–∞–ø—Ä–µ—â—ë–Ω")

    # 11. –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π —Å—Ä–æ–∫ –ø–æ—Å—Ç–∞–≤–∫–∏ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –≤ —Ç–µ–∫—Å—Ç–µ)
    delivery_match = re.search(r'(\d+)\s*(?:—Ä–∞–±–æ—á–∏—Ö|–∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö)?\s*–¥–Ω–µ–π?\s*(?:—Å –º–æ–º–µ–Ω—Ç–∞|–ø–æ—Å–ª–µ|–æ—Ç –¥–∞—Ç—ã)', text)
    if delivery_match:
        delivery_days = int(delivery_match.group(1))
        if delivery_days <= 5:
            flags.append(f"‚ö° –û—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫ –ø–æ—Å—Ç–∞–≤–∫–∏ ({delivery_days} –¥–Ω.)")

    return flags


class SmartMatcher:
    """
    Smart Matching Engine –¥–ª—è —Ç–µ–Ω–¥–µ—Ä–æ–≤.

    –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
    - Fuzzy matching –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
    - –£—á–µ—Ç —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –∏ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏
    - Scoring —Å–∏—Å—Ç–µ–º–∞ (0-100)
    - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏—Å–∫–ª—é—á–∞—é—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
    - –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    """

    # –°—Ç–æ–ø-—Å–ª–æ–≤–∞ - —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–µ —Ç–µ—Ä–º–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –ø–æ—á—Ç–∏ –≤–µ–∑–¥–µ
    # –≠—Ç–∏ —Å–ª–æ–≤–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –º–∞—Ç—á–∏–Ω–≥–µ
    STOP_WORDS = {
        '–∑–∞–∫—É–ø–∫–∞', '–∑–∞–∫—É–ø–∫–∏', '–∑–∞–∫—É–ø–æ–∫',
        '—É—Å–ª—É–≥–∞', '—É—Å–ª—É–≥–∏', '—É—Å–ª—É–≥',
        '–ø–æ—Å—Ç–∞–≤–∫–∞', '–ø–æ—Å—Ç–∞–≤–∫–∏', '–ø–æ—Å—Ç–∞–≤–æ–∫',
        '—Ä–∞–±–æ—Ç–∞', '—Ä–∞–±–æ—Ç—ã', '—Ä–∞–±–æ—Ç',
        '–æ–∫–∞–∑–∞–Ω–∏–µ', '–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ', '–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ',
        '–ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–µ', '–ø–æ–∫—É–ø–∫–∞',
        '—Ç–æ–≤–∞—Ä', '—Ç–æ–≤–∞—Ä—ã', '—Ç–æ–≤–∞—Ä–æ–≤',
        '–¥–ª—è', '–Ω—É–∂–¥', '—Ü–µ–ª–µ–π',
        '—Å–ª—É–∂–±–∞', '—Å–ª—É–∂–±—ã', '—Å–ª—É–∂–±',
        '—Å–∏—Å—Ç–µ–º–∞', '—Å–∏—Å—Ç–µ–º—ã', '—Å–∏—Å—Ç–µ–º',
        '–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ', '—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ',
    }

    # –°–ª–æ–≤–∞—Ä—å —Å–∏–Ω–æ–Ω–∏–º–æ–≤ (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å)
    # –í–ê–ñ–ù–û: –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã –¥–ª—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
    SYNONYMS = {
        '–∫–æ–º–ø—å—é—Ç–µ—Ä': ['–Ω–æ—É—Ç–±—É–∫', '–ø–∫', 'pc', '–Ω–æ—É—Ç–±—É–∫–æ–≤', '–∫–æ–º–ø—å—é—Ç–µ—Ä—ã', '–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ', '–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–π'],
        '–∫–æ–º–ø—å—é—Ç–µ—Ä—ã': ['–∫–æ–º–ø—å—é—Ç–µ—Ä', '–Ω–æ—É—Ç–±—É–∫', '–ø–∫', 'pc', '–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ', '–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–π'],
        '–Ω–æ—É—Ç–±—É–∫': ['–∫–æ–º–ø—å—é—Ç–µ—Ä', '–ø–∫', 'pc', '–Ω–æ—É—Ç–±—É–∫–∏', '–Ω–æ—É—Ç–±—É–∫–æ–≤', '–ª—ç–ø—Ç–æ–ø'],
        '–Ω–æ—É—Ç–±—É–∫–∏': ['–Ω–æ—É—Ç–±—É–∫', '–∫–æ–º–ø—å—é—Ç–µ—Ä', '–ø–∫', '–ª—ç–ø—Ç–æ–ø', '–Ω–æ—É—Ç–±—É–∫–æ–≤'],
        '–º–µ–¥–∏—Ü–∏–Ω–∞': ['–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ', '–∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ', '–±–æ–ª—å–Ω–∏—Ü–∞', '–ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞'],
        '–∫–∞–Ω—Ü–µ–ª—è—Ä–∏—è': ['–∫–∞–Ω—Ü—Ç–æ–≤–∞—Ä—ã', '–æ—Ñ–∏—Å', '–ø–∏—Å—å–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏'],
        '–º–µ–±–µ–ª—å': ['—Å—Ç–æ–ª—ã', '—Å—Ç—É–ª—å—è', '—à–∫–∞—Ñ—ã', '–æ—Ñ–∏—Å–Ω–∞—è –º–µ–±–µ–ª—å'],
        'linux': ['–ª–∏–Ω—É–∫—Å', '—É–±—É–Ω—Ç—É', 'ubuntu', 'debian', 'centos', 'redhat', 'astra linux', '–∞—Å—Ç—Ä–∞', '–∞–ª—å—Ç –ª–∏–Ω—É–∫—Å'],
        '–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è': ['–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', '2fa', 'mfa', '–¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è', '–º–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è', '—Ç–æ–∫–µ–Ω', '—Å–º–∞—Ä—Ç-–∫–∞—Ä—Ç'],
        '–∫–∞—Ç–∞–ª–æ–≥': ['ldap', 'active directory', 'ad', '–¥–æ–º–µ–Ω', 'directory'],
        '—Å–µ—Ä–≤–µ—Ä': ['—Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', '—Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞', 'blade', '—Å–µ—Ä–≤–µ—Ä—ã'],
        '—Å–µ—Ä–≤–µ—Ä—ã': ['—Å–µ—Ä–≤–µ—Ä', '—Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', '—Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞'],
        '—Å–µ—Ç—å': ['—Å–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', '–∫–æ–º–º—É—Ç–∞—Ç–æ—Ä', '–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä', 'switch', 'router'],
        '–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ': ['–ø–æ', '—Å–æ—Ñ—Ç', 'software', '–ª–∏—Ü–µ–Ω–∑–∏—è', '–ª–∏—Ü–µ–Ω–∑–∏–∏'],
        '–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ': ['—Ç–µ—Ö–Ω–∏–∫–∞', '—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', '–∞–ø–ø–∞—Ä–∞—Ç—É—Ä–∞'],
    }

    # –°–æ—Å—Ç–∞–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–ª–æ–≤
    # –≠—Ç–∏ —Ñ—Ä–∞–∑—ã –º–∞—Ç—á–∞—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ, –∞ –Ω–µ –ø–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–ª–æ–≤–∞–º
    COMPOUND_PHRASES = {
        # IT —Ç–µ—Ä–º–∏–Ω—ã
        '—Å–ª—É–∂–±–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤': ['directory service', 'ldap', 'active directory', 'ad ds'],
        '–¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è': ['2fa', 'two-factor', '–º—É–ª—å—Ç–∏—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è'],
        '–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞': ['–æ—Å', 'os', 'windows', 'linux'],
        '–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ': ['–ø–æ', '—Å–æ—Ñ—Ç', 'software'],
        '–∞–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞': ['–∞–Ω—Ç–∏–≤–∏—Ä—É—Å', '–∫–∞—Å–ø–µ—Ä—Å–∫–∏–π', 'dr.web', 'eset'],
        '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å': ['–∏–±–ø', 'cybersecurity', '–∑–∞—â–∏—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏'],
        '–≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤': ['vmware', 'hyper-v', 'proxmox', '–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã'],
        '—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ': ['–±—ç–∫–∞–ø', 'backup', '–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ'],
        '—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å': ['—ç—Ü–ø', '—ç–ø', '–∫—Ä–∏–ø—Ç–æ–ø—Ä–æ', '—Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å'],
        # –î—Ä—É–≥–∏–µ –æ–±–ª–∞—Å—Ç–∏
        '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ': ['–º–µ–¥—Ç–µ—Ö–Ω–∏–∫–∞', '–º–µ–¥. –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ'],
        '–æ—Ñ–∏—Å–Ω–∞—è –º–µ–±–µ–ª—å': ['—Ä–∞–±–æ—á–∏–µ –º–µ—Å—Ç–∞', '—Å—Ç–æ–ª—ã –æ—Ñ–∏—Å–Ω—ã–µ'],
    }

    # –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã - –µ—Å–ª–∏ –æ–Ω–∏ –Ω–∞–π–¥–µ–Ω—ã, —Ç–µ–Ω–¥–µ—Ä –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è
    # –≠—Ç–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
    NEGATIVE_PATTERNS = {
        # –í–æ–µ–Ω–Ω–∞—è/—Å–∏–ª–æ–≤–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞ (—á–∞—Å—Ç–æ –ø—É—Ç–∞–µ—Ç—Å—è —Å–æ "—Å–ª—É–∂–±–æ–π")
        '–≤–æ–µ–Ω–Ω–∞—è —Å–ª—É–∂–±–∞': True,
        '–≤–æ–∏–Ω—Å–∫–∞—è —Å–ª—É–∂–±–∞': True,
        '–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–∞—è —Å–ª—É–∂–±–∞': True,
        '—Å–ª—É–∂–±–∞ –ø–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É': True,
        '–ø—Ä–∏–∑—ã–≤ –Ω–∞ —Å–ª—É–∂–±—É': True,
        '–ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –≥—Ä–∞–∂–¥–∞–Ω': True,
        '–∞–≥–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã': True,
        '–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è': True,
        '–≤–æ–µ–Ω–∫–æ–º–∞—Ç': True,
        # –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞ (–ø—É—Ç–∞–µ—Ç—Å—è —Å "—Å–∏—Å—Ç–µ–º–æ–π" –∏ "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π")
        '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å': True,
        '—Å–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å': True,
        '–ª–µ—á–µ–±–Ω–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ': True,
        '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –æ—Ç—Ö–æ–¥–æ–≤': True,
        '–±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ–±—Ä–∞–∑—Ü–æ–≤': True,
        '–ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤': True,
        # –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞
        '–∫–∞–ø–∏—Ç–∞–ª—å–Ω—ã–π —Ä–µ–º–æ–Ω—Ç': True,
        '—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∑–¥–∞–Ω–∏—è': True,
        '—Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–¥–∞–Ω–∏—è': True,
        # –ü—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞
        '–ø—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è': True,
        '–ø–∏—â–µ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã': True,
        '—Å—Ç–æ–ª–æ–≤–∞—è': True,
        # –†–µ–∫–ª–∞–º–Ω–∞—è/–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞ (–ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –¥–ª—è IT)
        '–ø–æ—Å—Ç–∞–≤–∫–∞ –±–∞–Ω–Ω–µ—Ä–æ–≤': True,
        '—Ä–µ–∫–ª–∞–º–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã': True,
        '—Ä–µ–∫–ª–∞–º–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è': True,
        '–Ω–∞—Ä—É–∂–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞': True,
        '–ø–æ–ª–∏–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è': True,
        '–ø–µ—á–∞—Ç–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è': True,
        # –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è/–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ-IT (–ø—É—Ç–∞–µ—Ç—Å—è —Å IT-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º)
        '—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞': True,
        '—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞': True,
        '—ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π —Å–æ–≤–µ—Ç': True,
        # –ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è –∏ –±—ã—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
        '–∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã': True,
        '—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã': True,
        '—É–±–æ—Ä–∫–∞ –ø–æ–º–µ—â–µ–Ω–∏–π': True,
        '–∫–ª–∏–Ω–∏–Ω–≥': True,
        # –ñ–∏–≤–æ—Ç–Ω—ã–µ –∏ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∏—è (–ø—É—Ç–∞–µ—Ç—Å—è —Å "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π")
        '–æ—Ç–ª–æ–≤ —Å–æ–±–∞–∫': True,
        '–æ—Ç–ª–æ–≤ –∂–∏–≤–æ—Ç–Ω—ã—Ö': True,
        '–±–µ–∑–Ω–∞–¥–∑–æ—Ä–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö': True,
        '–±–µ–∑–¥–æ–º–Ω—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö': True,
        '–≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω': True,
        # –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏ event (–ø—É—Ç–∞–µ—Ç—Å—è —Å "–ª–æ–≥–∏—Å—Ç–∏–∫–æ–π" –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –∑–∞–∫–∞–∑—á–∏–∫–∞)
        '–≤–∏–∑—É–∞–ª—å–Ω–æ–º—É —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—é –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π': True,
        '–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—é –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è': True,
        '–ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è': True,
        'event-—É—Å–ª—É–≥–∏': True,
        # –û—Ö—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏
        '–æ—Ö—Ä–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥': True,
        '–æ—Ö—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏': True,
        '–ø—É–ª—å—Ç–æ–≤–∞—è –æ—Ö—Ä–∞–Ω–∞': True,
        # –ñ–∏–¥–∫–∏–µ –±—ã—Ç–æ–≤—ã–µ –æ—Ç—Ö–æ–¥—ã
        '–∂–∏–¥–∫–∏—Ö –±—ã—Ç–æ–≤—ã—Ö –æ—Ç—Ö–æ–¥–æ–≤': True,
        '–∂–±–æ': True,
    }

    # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–∞—Ç—á–∏–Ω–≥–∞
    MIN_KEYWORDS_FOR_STRICT_MODE = 8  # –ü—Ä–∏ 8+ keywords –≤–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º
    MIN_MATCH_RATIO_STRICT = 0.10  # –ú–∏–Ω–∏–º—É–º 10% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –≤ —Å—Ç—Ä–æ–≥–æ–º —Ä–µ–∂–∏–º–µ
    MIN_MATCHES_ABSOLUTE = 2  # –ú–∏–Ω–∏–º—É–º 2 —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–ª—è —Å—Ç—Ä–æ–≥–æ–≥–æ —Ä–µ–∂–∏–º–∞

    # üß™ –ë–ï–¢–ê: –°–∏–Ω–æ–Ω–∏–º—ã –±—Ä–µ–Ω–¥–æ–≤ (–ª–∞—Ç–∏–Ω–∏—Ü–∞ ‚Üî –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
    # –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –º–∞—Ç—á–∏–Ω–≥–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—è–º–∏ –±—Ä–µ–Ω–¥–æ–≤
    BRAND_SYNONYMS = {
        # –ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä—ã –∏ –ø–Ω–µ–≤–º–∞—Ç–∏–∫–∞
        'atlas copco': ['–∞—Ç–ª–∞—Å –∫–æ–ø–∫–æ', '–∞—Ç–ª–∞—Å-–∫–æ–ø–∫–æ', 'atlascopco'],
        '–∞—Ç–ª–∞—Å –∫–æ–ø–∫–æ': ['atlas copco', 'atlascopco'],
        'ingersoll rand': ['–∏–Ω–≥–µ—Ä—Å–æ–ª–ª —Ä—ç–Ω–¥', 'ingersoll'],
        'kaeser': ['–∫–∞–π–∑–µ—Ä'],

        # IT –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
        'cisco': ['—Ü–∏—Å–∫–æ', '—Å–∏—Å–∫–æ'],
        '—Ü–∏—Å–∫–æ': ['cisco', '—Å–∏—Å–∫–æ'],
        'hewlett packard': ['—Ö—å—é–ª–µ—Ç—Ç –ø–∞–∫–∫–∞—Ä–¥', 'hp', '—Ö–ø'],
        'hp': ['hewlett packard', '—Ö—å—é–ª–µ—Ç—Ç –ø–∞–∫–∫–∞—Ä–¥', '—Ö–ø'],
        'dell': ['–¥–µ–ª–ª'],
        'lenovo': ['–ª–µ–Ω–æ–≤–æ'],
        'ibm': ['–∏–±–º', '–∞–π–±–∏—ç–º'],
        'apple': ['—ç–ø–ª', '—ç–ø–ø–ª'],
        'intel': ['–∏–Ω—Ç–µ–ª'],
        'amd': ['–∞–º–¥'],

        # –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
        'komatsu': ['–∫–æ–º–∞—Ü—É'],
        '–∫–æ–º–∞—Ü—É': ['komatsu'],
        'caterpillar': ['–∫–∞—Ç–µ—Ä–ø–∏–ª–ª–µ—Ä', '–∫–∞—Ç–µ—Ä–ø–∏–ª–ª–∞—Ä', 'cat', '–∫–∞—Ç'],
        'cat': ['caterpillar', '–∫–∞—Ç–µ—Ä–ø–∏–ª–ª–µ—Ä'],
        'hitachi': ['—Ö–∏—Ç–∞—á–∏'],
        'volvo': ['–≤–æ–ª—å–≤–æ'],

        # –≠–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
        'bosch': ['–±–æ—à'],
        '–±–æ—à': ['bosch'],
        'makita': ['–º–∞–∫–∏—Ç–∞'],
        '–º–∞–∫–∏—Ç–∞': ['makita'],
        'hilti': ['—Ö–∏–ª—Ç–∏'],
        '—Ö–∏–ª—Ç–∏': ['hilti'],
        'dewalt': ['–¥–µ–≤–æ–ª—Ç', '–¥–µ–≤–æ–ª—å—Ç'],
        'metabo': ['–º–µ—Ç–∞–±–æ'],

        # –≠–ª–µ–∫—Ç—Ä–æ—Ç–µ—Ö–Ω–∏–∫–∞
        'siemens': ['—Å–∏–º–µ–Ω—Å'],
        '—Å–∏–º–µ–Ω—Å': ['siemens'],
        'schneider electric': ['—à–Ω–µ–π–¥–µ—Ä —ç–ª–µ–∫—Ç—Ä–∏–∫', 'schneider'],
        'abb': ['–∞–±–±'],
        'legrand': ['–ª–µ–≥—Ä–∞–Ω–¥'],

        # –ü–û –∏ IT-–∫–æ–º–ø–∞–Ω–∏–∏
        'microsoft': ['–º–∞–π–∫—Ä–æ—Å–æ—Ñ—Ç', 'ms'],
        '–º–∞–π–∫—Ä–æ—Å–æ—Ñ—Ç': ['microsoft', 'ms'],
        'kaspersky': ['–∫–∞—Å–ø–µ—Ä—Å–∫–∏–π', 'kaspersky lab'],
        '–∫–∞—Å–ø–µ—Ä—Å–∫–∏–π': ['kaspersky'],
        'oracle': ['–æ—Ä–∞–∫–ª'],
        'sap': ['—Å–∞–ø'],
        'vmware': ['–≤–º–≤–∞—Ä–µ', 'vmvare'],
        '1c': ['1—Å', '–æ–¥–∏–Ω —ç—Å'],
        '1—Å': ['1c', '–æ–¥–∏–Ω —ç—Å'],

        # –ù–∞—Å–æ—Å—ã –∏ –∫–ª–∏–º–∞—Ç
        'grundfos': ['–≥—Ä—É–Ω–¥—Ñ–æ—Å'],
        'wilo': ['–≤–∏–ª–æ'],
        'danfoss': ['–¥–∞–Ω—Ñ–æ—Å—Å'],
        'daikin': ['–¥–∞–π–∫–∏–Ω'],

        # –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
        'philips': ['—Ñ–∏–ª–∏–ø—Å'],
        'ge healthcare': ['–¥–∂–∏ —Ö–µ–ª—Å–∫–µ–∞', 'ge'],
        'mindray': ['–º–∏–Ω–¥—Ä–µ–π'],

        # –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –∏ —Ç–µ—Ö–Ω–∏–∫–∞
        'mercedes': ['–º–µ—Ä—Å–µ–¥–µ—Å', 'mercedes-benz'],
        'volkswagen': ['—Ñ–æ–ª—å–∫—Å–≤–∞–≥–µ–Ω', 'vw'],
        'toyota': ['—Ç–æ–π–æ—Ç–∞'],
        'scania': ['—Å–∫–∞–Ω–∏—è'],
        'man': ['–º–∞–Ω'],
    }

    # üß™ –ë–ï–¢–ê: –ê–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä—ã (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è)
    # –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –º–∞—Ç—á–∏–Ω–≥–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π —Å –ø–æ–ª–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
    ABBREVIATIONS = {
        # IT —Å–∏—Å—Ç–µ–º—ã
        'scada': ['—Å–∫–∞–¥–∞', 'scada-—Å–∏—Å—Ç–µ–º–∞', '—Å–∫—É'],
        '—Å–∫–∞–¥–∞': ['scada', 'scada-—Å–∏—Å—Ç–µ–º–∞'],
        'erp': ['–µ—Ä–ø', 'erp-—Å–∏—Å—Ç–µ–º–∞', '—Å–∏—Å—Ç–µ–º–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤'],
        'crm': ['—Ü—Ä–º', 'crm-—Å–∏—Å—Ç–µ–º–∞', '—Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏'],
        'mes': ['–º–µ—Å', '—Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º'],

        # –°–µ—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
        'vpn': ['–≤–ø–Ω', '–≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —á–∞—Å—Ç–Ω–∞—è —Å–µ—Ç—å'],
        '–≤–ø–Ω': ['vpn'],
        'utm': ['—é—Ç–º', 'unified threat management'],
        'ngfw': ['–º–µ–∂—Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è'],
        'ids': ['—Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –≤—Ç–æ—Ä–∂–µ–Ω–∏–π'],
        'ips': ['—Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –≤—Ç–æ—Ä–∂–µ–Ω–∏–π'],

        # –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
        'ups': ['–∏–±–ø', '–∏—Å—Ç–æ—á–Ω–∏–∫ –±–µ—Å–ø–µ—Ä–µ–±–æ–π–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è'],
        '–∏–±–ø': ['ups', '–∏—Å—Ç–æ—á–Ω–∏–∫ –±–µ—Å–ø–µ—Ä–µ–±–æ–π–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è'],
        'pdu': ['–ø–¥—É', '—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è', '–±–ª–æ–∫ —Ä–æ–∑–µ—Ç–æ–∫'],
        'kvm': ['–∫–≤–º', '–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∫–æ–Ω—Å–æ–ª–∏'],
        'nas': ['–Ω–∞—Å', '—Å–µ—Ç–µ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ'],
        'san': ['—Å–∞–Ω', '—Å–µ—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö'],

        # –ö–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        'ssd': ['—Å—Å–¥', '—Ç–≤–µ—Ä–¥–æ—Ç–µ–ª—å–Ω—ã–π –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å', 'solid state'],
        'hdd': ['—Ö–¥–¥', '–∂—ë—Å—Ç–∫–∏–π –¥–∏—Å–∫', '–∂–µ—Å—Ç–∫–∏–π –¥–∏—Å–∫'],
        'cpu': ['—Ü–ø—É', '–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä', '—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä'],
        'gpu': ['–≥–ø—É', '–≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞', '–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä'],
        'ram': ['–æ–∑—É', '–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å', '–æ–ø–µ—Ä–∞—Ç–∏–≤–∫–∞'],
        '–æ–∑—É': ['ram', '–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å'],

        # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
        'plc': ['–ø–ª–∫', '–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º—ã–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä', 'plc-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä'],
        '–ø–ª–∫': ['plc', '–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º—ã–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä'],
        'hmi': ['—á–º–∏', '—á–µ–ª–æ–≤–µ–∫–æ-–º–∞—à–∏–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å', '–ø–∞–Ω–µ–ª—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞'],
        'dcs': ['—Ä—Å—É', '—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è'],

        # –°–≤—è–∑—å
        'voip': ['–≤–æ–∏–ø', 'ip-—Ç–µ–ª–µ—Ñ–æ–Ω–∏—è', '–∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ç–µ–ª–µ—Ñ–æ–Ω–∏—è'],
        'pbx': ['–∞—Ç—Å', '–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–∞—è —Å—Ç–∞–Ω—Ü–∏—è'],
        '–∞—Ç—Å': ['pbx', '—Ç–µ–ª–µ—Ñ–æ–Ω–Ω–∞—è —Å—Ç–∞–Ω—Ü–∏—è'],

        # –ü—Ä–æ—á–µ–µ
        'cad': ['—Å–∞–ø—Ä', '—Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è'],
        '—Å–∞–ø—Ä': ['cad', 'autocad'],
        'bim': ['–±–∏–º', '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –∑–¥–∞–Ω–∏—è'],
        'gis': ['–≥–∏—Å', '–≥–µ–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞'],
        '–≥–∏—Å': ['gis', '–≥–µ–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è'],
    }

    # –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –æ–∫—Ä—É–≥–∞ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è
    FEDERAL_DISTRICTS = {
        "—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π": [
            "–º–æ—Å–∫–≤–∞", "–º–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–±–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–±—Ä—è–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "–≤–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–≤–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∏–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "–∫–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∫–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∫—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "–ª–∏–ø–µ—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–æ—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Ä—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "—Å–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Ç–∞–º–±–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Ç–≤–µ—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "—Ç—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—è—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å"
        ],
        "—Å–µ–≤–µ—Ä–æ-–∑–∞–ø–∞–¥–Ω—ã–π": [
            "—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥", "–ª–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∞—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "–≤–æ–ª–æ–≥–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∫–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –∫–∞—Ä–µ–ª–∏—è",
            "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –∫–æ–º–∏", "–º—É—Ä–º–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–Ω–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥",
            "–Ω–æ–≤–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–ø—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å"
        ],
        "—é–∂–Ω—ã–π": [
            "—Ä–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∞—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–≤–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –∞–¥—ã–≥–µ—è", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –∫–∞–ª–º—ã–∫–∏—è", "–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π",
            "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –∫—Ä—ã–º", "–∫—Ä—ã–º", "—Å–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å"
        ],
        "—Å–µ–≤–µ—Ä–æ-–∫–∞–≤–∫–∞–∑—Å–∫–∏–π": [
            "—Å—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –¥–∞–≥–µ—Å—Ç–∞–Ω", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –∏–Ω–≥—É—à–µ—Ç–∏—è",
            "–∫–∞–±–∞—Ä–¥–∏–Ω–æ-–±–∞–ª–∫–∞—Ä—Å–∫–∞—è —Ä–µ—Å–ø—É–±–ª–∏–∫–∞", "–∫–∞—Ä–∞—á–∞–µ–≤–æ-—á–µ—Ä–∫–µ—Å—Å–∫–∞—è —Ä–µ—Å–ø—É–±–ª–∏–∫–∞",
            "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ —Å–µ–≤–µ—Ä–Ω–∞—è –æ—Å–µ—Ç–∏—è", "—á–µ—á–µ–Ω—Å–∫–∞—è —Ä–µ—Å–ø—É–±–ª–∏–∫–∞"
        ],
        "–ø—Ä–∏–≤–æ–ª–∂—Å–∫–∏–π": [
            "–Ω–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∫–∏—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Å–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "–æ—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–ø–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–ø–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π",
            "—Å–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—É–ª—å—è–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –±–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω",
            "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –º–∞—Ä–∏–π —ç–ª", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –º–æ—Ä–¥–æ–≤–∏—è", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ —Ç–∞—Ç–∞—Ä—Å—Ç–∞–Ω",
            "—É–¥–º—É—Ä—Ç—Å–∫–∞—è —Ä–µ—Å–ø—É–±–ª–∏–∫–∞", "—á—É–≤–∞—à—Å–∫–∞—è —Ä–µ—Å–ø—É–±–ª–∏–∫–∞"
        ],
        "—É—Ä–∞–ª—å—Å–∫–∏–π": [
            "—Å–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—á–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∫—É—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "—Ç—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Ö–∞–Ω—Ç—ã-–º–∞–Ω—Å–∏–π—Å–∫–∏–π", "—é–≥—Ä–∞", "—è–º–∞–ª–æ-–Ω–µ–Ω–µ—Ü–∫–∏–π"
        ],
        "—Å–∏–±–∏—Ä—Å–∫–∏–π": [
            "–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∞–ª—Ç–∞–π—Å–∫–∏–π –∫—Ä–∞–π", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –∞–ª—Ç–∞–π",
            "–∏—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∫–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π",
            "–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Ç–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ —Ç—ã–≤–∞", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ —Ö–∞–∫–∞—Å–∏—è"
        ],
        "–¥–∞–ª—å–Ω–µ–≤–æ—Å—Ç–æ—á–Ω—ã–π": [
            "—Ö–∞–±–∞—Ä–æ–≤—Å–∫–∏–π –∫—Ä–∞–π", "–ø—Ä–∏–º–æ—Ä—Å–∫–∏–π –∫—Ä–∞–π", "–∞–º—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "–∫–∞–º—á–∞—Ç—Å–∫–∏–π –∫—Ä–∞–π", "–º–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Å–∞—Ö–∞–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
            "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ —Å–∞—Ö–∞", "—è–∫—É—Ç–∏—è", "–µ–≤—Ä–µ–π—Å–∫–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –æ–±–ª–∞—Å—Ç—å",
            "—á—É–∫–æ—Ç—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –±—É—Ä—è—Ç–∏—è", "–∑–∞–±–∞–π–∫–∞–ª—å—Å–∫–∏–π –∫—Ä–∞–π"
        ]
    }

    # –ê–ª–∏–∞—Å—ã —Ä–µ–≥–∏–æ–Ω–æ–≤ (—Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è)
    REGION_ALIASES = {
        # –ì–æ—Ä–æ–¥–∞ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
        "—Å–ø–±": ["—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥", "–ø–∏—Ç–µ—Ä", "–ª–µ–Ω–∏–Ω–≥—Ä–∞–¥"],
        "—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥": ["—Å–ø–±", "–ø–∏—Ç–µ—Ä", "–ª–µ–Ω–∏–Ω–≥—Ä–∞–¥", "—Å.-–ø–µ—Ç–µ—Ä–±—É—Ä–≥", "—Å-–ø–µ—Ç–µ—Ä–±—É—Ä–≥"],
        "–º—Å–∫": ["–º–æ—Å–∫–≤–∞"],
        "–º–æ—Å–∫–≤–∞": ["–º—Å–∫"],
        # –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–µ –æ–∫—Ä—É–≥–∞ (—Å–æ–∫—Ä–∞—â–µ–Ω–∏—è)
        "—è–Ω–∞–æ": ["—è–º–∞–ª–æ-–Ω–µ–Ω–µ—Ü–∫–∏–π", "—è–º–∞–ª", "—è–º–∞–ª–æ-–Ω–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥"],
        "—è–º–∞–ª–æ-–Ω–µ–Ω–µ—Ü–∫–∏–π": ["—è–Ω–∞–æ", "—è–º–∞–ª"],
        "—Ö–º–∞–æ": ["—Ö–∞–Ω—Ç—ã-–º–∞–Ω—Å–∏–π—Å–∫–∏–π", "—é–≥—Ä–∞", "—Ö–∞–Ω—Ç—ã-–º–∞–Ω—Å–∏–π—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥"],
        "—Ö–∞–Ω—Ç—ã-–º–∞–Ω—Å–∏–π—Å–∫–∏–π": ["—Ö–º–∞–æ", "—é–≥—Ä–∞"],
        "—é–≥—Ä–∞": ["—Ö–º–∞–æ", "—Ö–∞–Ω—Ç—ã-–º–∞–Ω—Å–∏–π—Å–∫–∏–π"],
        "–Ω–∞–æ": ["–Ω–µ–Ω–µ—Ü–∫–∏–π", "–Ω–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥"],
        "–Ω–µ–Ω–µ—Ü–∫–∏–π": ["–Ω–∞–æ"],
        "—á–∞–æ": ["—á—É–∫–æ—Ç—Å–∫–∏–π", "—á—É–∫–æ—Ç–∫–∞", "—á—É–∫–æ—Ç—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥"],
        "—á—É–∫–æ—Ç—Å–∫–∏–π": ["—á–∞–æ", "—á—É–∫–æ—Ç–∫–∞"],
        # –†–µ—Å–ø—É–±–ª–∏–∫–∏
        "—Ç–∞—Ç–∞—Ä—Å—Ç–∞–Ω": ["—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ —Ç–∞—Ç–∞—Ä—Å—Ç–∞–Ω", "—Ä—Ç"],
        "–±–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω": ["—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –±–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω", "–±–∞—à–∫–∏—Ä–∏—è"],
        "–¥–∞–≥–µ—Å—Ç–∞–Ω": ["—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –¥–∞–≥–µ—Å—Ç–∞–Ω"],
        "—è–∫—É—Ç–∏—è": ["—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ —Å–∞—Ö–∞", "—Å–∞—Ö–∞"],
        "—Å–∞—Ö–∞": ["—è–∫—É—Ç–∏—è", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ —Å–∞—Ö–∞"],
        "–∫—Ä—ã–º": ["—Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –∫—Ä—ã–º"],
        # –ö—Ä–∞—è
        "–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫": ["–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π"],
        "–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π": ["–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫", "–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π"],
        "–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä": ["–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π", "–∫—É–±–∞–Ω—å"],
        "–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π": ["–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä", "–∫—É–±–∞–Ω—å"],
        # –û–±–ª–∞—Å—Ç–∏ (–≥–æ—Ä–æ–¥–∞)
        "–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥": ["—Å–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Å–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è"],
        "—Å–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è": ["–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥"],
        "–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫": ["–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è"],
        "–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è": ["–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫"],
        "–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥": ["–Ω–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "–Ω–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è"],
        "–Ω–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è": ["–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥"],
        "—Ç—é–º–µ–Ω—å": ["—Ç—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", "—Ç—é–º–µ–Ω—Å–∫–∞—è"],
        "—Ç—é–º–µ–Ω—Å–∫–∞—è": ["—Ç—é–º–µ–Ω—å"],
    }

    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è matching engine."""
        self.stats = {
            'total_matches': 0,
            'high_score_matches': 0,  # score >= 70
            'medium_score_matches': 0,  # 50 <= score < 70
            'low_score_matches': 0,  # score < 50
        }

    def _expand_federal_districts(self, regions: List[str]) -> List[str]:
        """
        –†–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –æ–∫—Ä—É–≥–∞ –≤ —Å–ø–∏—Å–æ–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤.

        –ù–∞–ø—Ä–∏–º–µ—Ä: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥" ‚Üí ["–ú–æ—Å–∫–≤–∞", "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", ...]
        """
        expanded = []
        for region in regions:
            region_lower = region.lower().strip()

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–≥–æ–º
            found_district = False
            for district_key, district_regions in self.FEDERAL_DISTRICTS.items():
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è –§–û
                if (district_key in region_lower or
                    f"{district_key} —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π" in region_lower or
                    f"{district_key} —Ñ–æ" in region_lower):
                    expanded.extend(district_regions)
                    found_district = True
                    logger.debug(f"   üìç –†–∞—Å–∫—Ä—ã—Ç –§–û '{region}' ‚Üí {len(district_regions)} —Ä–µ–≥–∏–æ–Ω–æ–≤")
                    break

            if not found_district:
                # –≠—Ç–æ –æ–±—ã—á–Ω—ã–π —Ä–µ–≥–∏–æ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                expanded.append(region_lower)

        return expanded

    def _normalize_region(self, region: str) -> str:
        """–ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞, —É–±–∏—Ä–∞—è –ª–∏—à–Ω–∏–µ —Å–ª–æ–≤–∞."""
        region = region.lower().strip()
        # –£–±–∏—Ä–∞–µ–º —Ç–∏–ø–∏—á–Ω—ã–µ —Å—É—Ñ—Ñ–∏–∫—Å—ã/–ø—Ä–µ—Ñ–∏–∫—Å—ã
        remove_patterns = [
            "–æ–±–ª–∞—Å—Ç—å", "–∫—Ä–∞–π", "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞", "–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥", "–∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –æ–±–ª–∞—Å—Ç—å",
            "–≥–æ—Ä–æ–¥", "–≥.", "–æ–±–ª.", "—Ä–µ—Å–ø.", "–∞.–æ.", "–∞–æ", "—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥", "—Ñ–æ"
        ]
        for pattern in remove_patterns:
            region = region.replace(pattern, "")
        return region.strip()

    def _check_region_match(self, filter_regions: List[str], tender_region: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–≥–∏–æ–Ω–∞ —Ç–µ–Ω–¥–µ—Ä–∞ —Ñ–∏–ª—å—Ç—Ä—É.

        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç fuzzy matching —Å —É—á—ë—Ç–æ–º:
        - –í–∞—Ä–∏–∞—Ü–∏–π –Ω–∞–ø–∏—Å–∞–Ω–∏—è (–°–ü–± = –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥)
        - –°–æ–∫—Ä–∞—â–µ–Ω–∏–π (–Ø–ù–ê–û = –Ø–º–∞–ª–æ-–ù–µ–Ω–µ—Ü–∫–∏–π –ê–û)
        - –ß–∞—Å—Ç–∏—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

        Args:
            filter_regions: –°–ø–∏—Å–æ–∫ —Ä–µ–≥–∏–æ–Ω–æ–≤ –∏–∑ —Ñ–∏–ª—å—Ç—Ä–∞
            tender_region: –†–µ–≥–∏–æ–Ω —Ç–µ–Ω–¥–µ—Ä–∞

        Returns:
            True –µ—Å–ª–∏ —Ä–µ–≥–∏–æ–Ω –ø–æ–¥—Ö–æ–¥–∏—Ç, False –∏–Ω–∞—á–µ
        """
        if not filter_regions:
            return True  # –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ä–µ–≥–∏–æ–Ω—É

        if not tender_region or tender_region.strip() == "":
            # –†–µ–≥–∏–æ–Ω —Ç–µ–Ω–¥–µ—Ä–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω - –æ—Ç–∫–ª–æ–Ω—è–µ–º –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏–æ–Ω
            logger.info(f"   ‚õî –†–µ–≥–∏–æ–Ω —Ç–µ–Ω–¥–µ—Ä–∞ –ø—É—Å—Ç–æ–π, –Ω–æ —Ñ–∏–ª—å—Ç—Ä —Ç—Ä–µ–±—É–µ—Ç: {filter_regions[:3]}...")
            return False

        tender_region_lower = tender_region.lower().strip()
        tender_region_normalized = self._normalize_region(tender_region_lower)

        logger.debug(f"   üó∫Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏–æ–Ω–∞: tender='{tender_region_lower}' (norm: '{tender_region_normalized}')")
        logger.debug(f"   üó∫Ô∏è –§–∏–ª—å—Ç—Ä —Ä–µ–≥–∏–æ–Ω–æ–≤: {filter_regions[:5]}{'...' if len(filter_regions) > 5 else ''}")

        for filter_region in filter_regions:
            filter_region_lower = filter_region.lower().strip()
            filter_region_normalized = self._normalize_region(filter_region_lower)

            # 1. –ü—Ä—è–º–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            if filter_region_lower == tender_region_lower:
                logger.debug(f"   ‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞: {filter_region_lower}")
                return True

            # 2. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            if filter_region_normalized == tender_region_normalized:
                logger.debug(f"   ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: {filter_region_normalized}")
                return True

            # 3. –í—Ö–æ–∂–¥–µ–Ω–∏–µ (—Å —É—á—ë—Ç–æ–º –ø–æ—Ä—è–¥–∫–∞)
            if filter_region_lower in tender_region_lower:
                logger.debug(f"   ‚úÖ –§–∏–ª—å—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ —Ä–µ–≥–∏–æ–Ω–µ —Ç–µ–Ω–¥–µ—Ä–∞: '{filter_region_lower}' in '{tender_region_lower}'")
                return True

            if tender_region_lower in filter_region_lower:
                logger.debug(f"   ‚úÖ –†–µ–≥–∏–æ–Ω —Ç–µ–Ω–¥–µ—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ —Ñ–∏–ª—å—Ç—Ä–µ: '{tender_region_lower}' in '{filter_region_lower}'")
                return True

            # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π –Ω–∞ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ
            if len(filter_region_normalized) >= 4 and filter_region_normalized in tender_region_lower:
                logger.debug(f"   ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –≤ —Ä–µ–≥–∏–æ–Ω–µ: '{filter_region_normalized}' in '{tender_region_lower}'")
                return True

            if len(tender_region_normalized) >= 4 and tender_region_normalized in filter_region_lower:
                logger.debug(f"   ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–≥–∏–æ–Ω –≤ —Ñ–∏–ª—å—Ç—Ä–µ: '{tender_region_normalized}' in '{filter_region_lower}'")
                return True

            # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–∏–∞—Å–æ–≤
            aliases = self.REGION_ALIASES.get(filter_region_normalized, [])
            for alias in aliases:
                alias_lower = alias.lower()
                if alias_lower in tender_region_lower or tender_region_lower in alias_lower:
                    logger.debug(f"   ‚úÖ –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –∞–ª–∏–∞—Å—É: {filter_region_normalized} -> {alias_lower}")
                    return True

            # –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞–ª–∏–∞—Å—ã –¥–ª—è —Ä–µ–≥–∏–æ–Ω–∞ —Ç–µ–Ω–¥–µ—Ä–∞
            tender_aliases = self.REGION_ALIASES.get(tender_region_normalized, [])
            for alias in tender_aliases:
                alias_lower = alias.lower()
                if alias_lower in filter_region_lower or filter_region_lower in alias_lower:
                    logger.debug(f"   ‚úÖ –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –∞–ª–∏–∞—Å—É —Ç–µ–Ω–¥–µ—Ä–∞: {tender_region_normalized} -> {alias_lower}")
                    return True

        # –ù–∏—á–µ–≥–æ –Ω–µ —Å–æ–≤–ø–∞–ª–æ
        logger.info(f"   ‚õî –†–µ–≥–∏–æ–Ω –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç: tender='{tender_region_lower}', filter={filter_regions[:3]}...")
        return False

    def _is_stop_word(self, word: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–ª–æ–≤–æ —Å—Ç–æ–ø-—Å–ª–æ–≤–æ–º."""
        return word.lower().strip() in self.STOP_WORDS

    def _extract_meaningful_keywords(self, text: str) -> List[str]:
        """
        –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∑–Ω–∞—á–∏–º—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞.
        –£–¥–∞–ª—è–µ—Ç —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏ —Ä–∞–∑–±–∏–≤–∞–µ—Ç –ø–æ –∑–∞–ø—è—Ç—ã–º.
        """
        # –†–∞–∑–±–∏–≤–∞–µ–º –ø–æ –∑–∞–ø—è—Ç—ã–º
        parts = text.split(',')
        keywords = []

        for part in parts:
            # –†–∞–∑–±–∏–≤–∞–µ–º –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å –Ω–∞ —Å–ª–æ–≤–∞
            words = part.strip().split()
            meaningful_words = [w for w in words if not self._is_stop_word(w) and len(w) >= 3]
            if meaningful_words:
                # –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞
                keywords.extend(meaningful_words)

        return keywords

    def _word_boundary_match(self, keyword: str, text: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–ª–æ–≤–∞ —Å —É—á–µ—Ç–æ–º –≥—Ä–∞–Ω–∏—Ü —Å–ª–æ–≤.
        –ò–∑–±–µ–≥–∞–µ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π —Ç–∏–ø–∞ '—Å–ª—É–∂–±' –≤ '—Å–ª—É–∂–±—ã –≤–æ–µ–Ω–Ω–æ–π'.
        """
        keyword_lower = keyword.lower().strip()

        # –î–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–ª–æ–≤ (< 4 —Å–∏–º–≤–æ–ª–æ–≤) —Ç—Ä–µ–±—É–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏
        if len(keyword_lower) < 4:
            pattern = r'\b' + re.escape(keyword_lower) + r'\b'
            return bool(re.search(pattern, text, re.IGNORECASE))

        # –î–ª—è –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω—ã—Ö —Å–ª–æ–≤ - –∏—â–µ–º –Ω–∞—á–∞–ª–æ —Å–ª–æ–≤–∞
        # –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–π—Ç–∏ "linux" –≤ "linux-—Å–∏—Å—Ç–µ–º–∞" –∏–ª–∏ "–ª–∏–Ω—É–∫—Å"
        pattern = r'\b' + re.escape(keyword_lower)
        return bool(re.search(pattern, text, re.IGNORECASE))

    def _check_negative_patterns(self, text: str) -> Optional[str]:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤.

        Returns:
            –ù–∞–π–¥–µ–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –∏–ª–∏ None –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        """
        text_lower = text.lower()
        for pattern in self.NEGATIVE_PATTERNS:
            if pattern in text_lower:
                return pattern
        return None

    def _match_compound_phrase(self, phrase: str, text: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–Ω–æ–π —Ñ—Ä–∞–∑—ã –≤ —Ç–µ–∫—Å—Ç–µ.
        –§—Ä–∞–∑–∞ –¥–æ–ª–∂–Ω–∞ –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è —Ü–µ–ª–∏–∫–æ–º –∏–ª–∏ —á–µ—Ä–µ–∑ —Å–∏–Ω–æ–Ω–∏–º—ã.
        """
        phrase_lower = phrase.lower().strip()
        text_lower = text.lower()

        # –ü—Ä—è–º–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ñ—Ä–∞–∑—ã —Ü–µ–ª–∏–∫–æ–º
        if phrase_lower in text_lower:
            return True

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω–æ–Ω–∏–º—ã —Å–æ—Å—Ç–∞–≤–Ω–æ–π —Ñ—Ä–∞–∑—ã
        synonyms = self.COMPOUND_PHRASES.get(phrase_lower, [])
        for synonym in synonyms:
            if synonym.lower() in text_lower:
                return True

        return False

    def _extract_compound_phrases(self, keywords: List[str]) -> tuple:
        """
        –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤.

        Returns:
            (compound_phrases, remaining_keywords) - —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Å–ª–æ–≤–∞
        """
        compound_found = []
        remaining = []

        for keyword in keywords:
            keyword_lower = keyword.lower().strip()

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Å–æ—Å—Ç–∞–≤–Ω–æ–π —Ñ—Ä–∞–∑–æ–π
            if keyword_lower in self.COMPOUND_PHRASES:
                compound_found.append(keyword)
            else:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ keyword —Å–æ—Å—Ç–∞–≤–Ω—É—é —Ñ—Ä–∞–∑—É
                found_compound = False
                for phrase in self.COMPOUND_PHRASES:
                    if phrase in keyword_lower:
                        compound_found.append(phrase)
                        found_compound = True
                        # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–Ω–∞—á–∏–º—ã–µ —Å–ª–æ–≤–∞
                        remaining_text = keyword_lower.replace(phrase, '').strip()
                        if remaining_text:
                            for word in remaining_text.split():
                                if len(word) >= 3 and not self._is_stop_word(word):
                                    remaining.append(word)
                        break

                if not found_compound:
                    remaining.append(keyword)

        return compound_found, remaining

    def apply_feedback_penalty(
        self,
        score: int,
        tender: Dict[str, Any],
        user_negative_keywords: List[str]
    ) -> int:
        """
        –ü—Ä–∏–º–µ–Ω—è–µ—Ç —à—Ç—Ä–∞—Ñ –∫ score –Ω–∞ –æ—Å–Ω–æ–≤–µ feedback learning.

        –ï—Å–ª–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏/–æ–ø–∏—Å–∞–Ω–∏–∏ —Ç–µ–Ω–¥–µ—Ä–∞ –Ω–∞–π–¥–µ–Ω—ã —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        —á–∞—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–ª —Ä–∞–Ω–µ–µ, —Å–Ω–∏–∂–∞–µ–º score.

        Args:
            score: –¢–µ–∫—É—â–∏–π score
            tender: –î–∞–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ—Ä–∞
            user_negative_keywords: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ negative keywords –∏–∑ feedback

        Returns:
            –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π score
        """
        if not user_negative_keywords:
            return score

        searchable_text = (
            tender.get('name', '') + ' ' +
            (tender.get('description', '') or '')
        ).lower()

        penalties = 0
        matched_negative = []

        for keyword in user_negative_keywords:
            if self._word_boundary_match(keyword, searchable_text):
                penalties += 1
                matched_negative.append(keyword)

        if penalties > 0:
            # –®—Ç—Ä–∞—Ñ: 5% –∑–∞ –∫–∞–∂–¥–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –º–∞–∫—Å–∏–º—É–º 30%
            penalty_percent = min(0.30, penalties * 0.05)
            penalty_points = int(score * penalty_percent)
            new_score = max(0, score - penalty_points)

            logger.debug(
                f"   üìâ Feedback penalty: -{penalty_points} points "
                f"(matched: {matched_negative[:3]})"
            )
            return new_score

        return score

    def match_tender(
        self,
        tender: Dict[str, Any],
        filter_config: Dict[str, Any],
        user_negative_keywords: Optional[List[str]] = None
    ) -> Optional[Dict[str, Any]]:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–µ–Ω–¥–µ—Ä —Ñ–∏–ª—å—Ç—Ä—É.

        Args:
            tender: –î–∞–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ—Ä–∞
            filter_config: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user_negative_keywords: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ negative keywords (feedback learning)

        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∏–Ω–≥–∞ —Å–æ score –∏–ª–∏ None –µ—Å–ª–∏ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç
        """
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞
        keywords = self._parse_json_field(filter_config.get('keywords', '[]'))
        exclude_keywords = self._parse_json_field(filter_config.get('exclude_keywords', '[]'))
        price_min = filter_config.get('price_min')
        price_max = filter_config.get('price_max')
        regions = self._parse_json_field(filter_config.get('regions', '[]'))
        customer_types = self._parse_json_field(filter_config.get('customer_types', '[]'))
        tender_types = self._parse_json_field(filter_config.get('tender_types', '[]'))

        # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ—Ä–∞
        # –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (RSS –∏ HTML –ø–∞—Ä—Å–µ—Ä—ã)
        tender_name = tender.get('name', '').lower()
        tender_description = tender.get('description', '') or tender.get('summary', '')
        tender_description = tender_description.lower()
        tender_price = tender.get('price')
        # –†–µ–≥–∏–æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—è—Ö
        tender_region = (tender.get('region', '') or tender.get('customer_region', '') or '').lower()
        tender_type = tender.get('purchase_type', '') or tender.get('tender_type', '')
        tender_type = tender_type.lower()
        customer_name = tender.get('customer_name', '') or tender.get('customer', '')
        customer_name = customer_name.lower()

        # –í–ê–ñ–ù–û: –ù–ï –≤–∫–ª—é—á–∞–µ–º customer_name –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫!
        # –ò–Ω–∞—á–µ "–£–ü–†–ê–í–õ–ï–ù–ò–ï –õ–û–ì–ò–°–¢–ò–ö–ò" –º–∞—Ç—á–∏—Ç –ª—é–±—ã–µ —Ç–µ–Ω–¥–µ—Ä—ã —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑—á–∏–∫–∞
        # –ü–æ–∏—Å–∫ –∏–¥—ë—Ç –¢–û–õ–¨–ö–û –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –æ–ø–∏—Å–∞–Ω–∏—é —Ç–µ–Ω–¥–µ—Ä–∞
        searchable_text = f"{tender_name} {tender_description}"

        # –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑—á–∏–∫–∞ —Ö—Ä–∞–Ω–∏–º –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ (customer_keywords)
        customer_text = customer_name

        # ============================================
        # 1. –ü–†–û–í–ï–†–ö–ê –ò–°–ö–õ–Æ–ß–ê–Æ–©–ò–• –§–ò–õ–¨–¢–†–û–í
        # ============================================

        # 1.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (–Ω–∏–∑–∫–∏–π score, –Ω–æ –Ω–µ –∏—Å–∫–ª—é—á–∞–µ–º)
        negative_match = self._check_negative_patterns(searchable_text)
        if negative_match:
            logger.debug(f"   ‚ö†Ô∏è –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω (low score): {negative_match}")
            return {
                'filter_id': filter_config.get('id'),
                'filter_name': filter_config.get('name'),
                'score': 5,
                'matched_keywords': [],
                'reasons': [f'–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: {negative_match}'],
                'matched_at': datetime.now().isoformat(),
                'tender_number': tender.get('number'),
                'tender_name': tender.get('name'),
                'tender_price': tender_price,
                'tender_url': tender.get('url'),
                'red_flags': detect_red_flags(tender)
            }

        # 1.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏—Å–∫–ª—é—á–∞—é—â–∏—Ö —Å–ª–æ–≤ (—Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Å–ª–æ–≤)
        if exclude_keywords:
            for keyword in exclude_keywords:
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Å–ª–æ–≤ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
                if self._word_boundary_match(keyword, searchable_text):
                    logger.debug(f"   ‚õî –ò—Å–∫–ª—é—á–µ–Ω–æ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É: {keyword}")
                    return None

        # ============================================
        # 2. –ü–†–û–í–ï–†–ö–ê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–• –£–°–õ–û–í–ò–ô
        # ============================================

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã
        if price_min is not None and tender_price is not None:
            if tender_price < price_min:
                logger.debug(f"   ‚õî –¶–µ–Ω–∞ —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∞—è: {tender_price} < {price_min}")
                return None

        if price_max is not None and tender_price is not None:
            if tender_price > price_max:
                logger.debug(f"   ‚õî –¶–µ–Ω–∞ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞—è: {tender_price} > {price_max}")
                return None

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏–æ–Ω–∞ (–°–¢–†–û–ì–ê–Ø - –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω —Ä–µ–≥–∏–æ–Ω –≤ —Ñ–∏–ª—å—Ç—Ä–µ, —Ç–µ–Ω–¥–µ—Ä –î–û–õ–ñ–ï–ù —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å)
        if regions:
            # –†–∞—Å–∫—Ä—ã–≤–∞–µ–º —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –æ–∫—Ä—É–≥–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã
            expanded_regions = self._expand_federal_districts(regions)

            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–π –º–µ—Ç–æ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞–ª–∏–∞—Å–æ–≤
            if not self._check_region_match(expanded_regions, tender_region):
                return None  # –°–¢–†–û–ì–ê–Ø –§–ò–õ–¨–¢–†–ê–¶–ò–Ø: –æ—Ç–∫–ª–æ–Ω—è–µ–º —Ç–µ–Ω–¥–µ—Ä—ã –∏–∑ –¥—Ä—É–≥–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤!

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ç–µ–Ω–¥–µ—Ä–∞ (–Ω–µ —Å—Ç—Ä–æ–≥–∞—è - –Ω–µ –æ—Ç–∫–ª–æ–Ω—è–µ–º –µ—Å–ª–∏ —Ç–∏–ø –Ω–µ —É–∫–∞–∑–∞–Ω)
        # RSS/–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ —Ç–∏–ø
        if tender_types and tender_type:
            type_match = False
            for t_type in tender_types:
                if t_type.lower() in tender_type:
                    type_match = True
                    break

            if not type_match:
                logger.debug(f"   ‚õî –¢–∏–ø —Ç–µ–Ω–¥–µ—Ä–∞ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç: {tender_type}")
                # –ù–µ –æ—Ç–∫–ª–æ–Ω—è–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é
                # return None

        # ============================================
        # 3. SCORING –ü–û –ö–õ–Æ–ß–ï–í–´–ú –°–õ–û–í–ê–ú
        # ============================================

        score = 0
        matched_keywords = []

        if keywords:
            # –®–ê–ì 1: –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
            compound_phrases, remaining_keywords = self._extract_compound_phrases(keywords)

            # –®–ê–ì 2: –§–∏–ª—å—Ç—Ä—É–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
            meaningful_keywords = []
            for keyword in remaining_keywords:
                keyword_lower = keyword.lower().strip()
                if not keyword_lower:
                    continue
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
                if self._is_stop_word(keyword_lower):
                    logger.debug(f"   ‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–æ: {keyword}")
                    continue
                meaningful_keywords.append(keyword)

            # –®–ê–ì 3: –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –∑–Ω–∞—á–∏–º—ã—Ö —Å–ª–æ–≤ - –ø—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –∏–∑ —Ñ—Ä–∞–∑
            if not meaningful_keywords and not compound_phrases:
                for keyword in keywords:
                    extracted = self._extract_meaningful_keywords(keyword)
                    meaningful_keywords.extend(extracted)

            # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–≥–æ —Å–∫–æ—Ä–∏–Ω–≥–∞
            total_criteria = len(compound_phrases) + len(meaningful_keywords)
            if total_criteria == 0:
                logger.debug(f"   ‚õî –ù–µ—Ç –∑–Ω–∞—á–∏–º—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏")
                return None

            logger.debug(f"   üìù –°–æ—Å—Ç–∞–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã: {compound_phrases}")
            logger.debug(f"   üìù –ó–Ω–∞—á–∏–º—ã–µ —Å–ª–æ–≤–∞: {meaningful_keywords}")

            # –®–ê–ì 4: –ú–∞—Ç—á–∏–Ω–≥ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö —Ñ—Ä–∞–∑ (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
            for phrase in compound_phrases:
                if self._match_compound_phrase(phrase, searchable_text):
                    score += 35  # –í—ã—Å–æ–∫–∏–π –±–æ–Ω—É—Å –∑–∞ —Å–æ—Å—Ç–∞–≤–Ω—É—é —Ñ—Ä–∞–∑—É
                    matched_keywords.append(f"üìå {phrase}")
                    logger.debug(f"   ‚úÖ –ù–∞–π–¥–µ–Ω–∞ —Å–æ—Å—Ç–∞–≤–Ω–∞—è —Ñ—Ä–∞–∑–∞: {phrase}")

            # –®–ê–ì 5: –ú–∞—Ç—á–∏–Ω–≥ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
            for keyword in meaningful_keywords:
                keyword_lower = keyword.lower().strip()

                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ –∏ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
                if not keyword_lower or self._is_stop_word(keyword_lower):
                    continue

                # –ü—Ä—è–º–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –≥—Ä–∞–Ω–∏—Ü —Å–ª–æ–≤
                if self._word_boundary_match(keyword_lower, searchable_text):
                    score += 25  # –ë–æ–Ω—É—Å –∑–∞ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                    matched_keywords.append(keyword)
                    logger.debug(f"   ‚úÖ –ù–∞–π–¥–µ–Ω–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ: {keyword}")
                    continue

                # –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–∫–æ—Ä–µ–Ω—å —Å–ª–æ–≤–∞, –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)
                if len(keyword_lower) >= 5:
                    root = keyword_lower[:max(5, len(keyword_lower) - 2)]
                    if self._word_boundary_match(root, searchable_text):
                        score += 18
                        matched_keywords.append(f"{keyword} (—á–∞—Å—Ç–∏—á–Ω–æ–µ)")
                        logger.debug(f"   ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: {root}* ‚Üí {keyword}")
                        continue

                # –ü–æ–∏—Å–∫ —Å–∏–Ω–æ–Ω–∏–º–æ–≤
                synonyms = self.SYNONYMS.get(keyword_lower, [])
                synonym_found = False
                for synonym in synonyms:
                    if self._word_boundary_match(synonym.lower(), searchable_text):
                        score += 20
                        matched_keywords.append(f"{keyword} (—Å–∏–Ω–æ–Ω–∏–º: {synonym})")
                        logger.debug(f"   ‚úÖ –ù–∞–π–¥–µ–Ω —Å–∏–Ω–æ–Ω–∏–º: {synonym} ‚Üí {keyword}")
                        synonym_found = True
                        break

                if synonym_found:
                    continue

                # üß™ –ë–ï–¢–ê: –ü–æ–∏—Å–∫ –ø–æ –±—Ä–µ–Ω–¥–∞–º (–ª–∞—Ç–∏–Ω–∏—Ü–∞ ‚Üî –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
                brand_synonyms = self.BRAND_SYNONYMS.get(keyword_lower, [])
                for brand_syn in brand_synonyms:
                    if self._word_boundary_match(brand_syn.lower(), searchable_text):
                        score += 22  # –ß—É—Ç—å –≤—ã—à–µ —á–µ–º –æ–±—ã—á–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã - –±—Ä–µ–Ω–¥—ã –≤–∞–∂–Ω—ã
                        matched_keywords.append(f"{keyword} (–±—Ä–µ–Ω–¥: {brand_syn})")
                        logger.debug(f"   ‚úÖ üß™ –ù–∞–π–¥–µ–Ω –±—Ä–µ–Ω–¥: {brand_syn} ‚Üí {keyword}")
                        synonym_found = True
                        break

                if synonym_found:
                    continue

                # üß™ –ë–ï–¢–ê: –ü–æ–∏—Å–∫ –ø–æ –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞–º (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è)
                abbrev_synonyms = self.ABBREVIATIONS.get(keyword_lower, [])
                for abbrev_syn in abbrev_synonyms:
                    if self._word_boundary_match(abbrev_syn.lower(), searchable_text):
                        score += 22  # –ê–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä—ã —Ç–æ–∂–µ –≤–∞–∂–Ω—ã
                        matched_keywords.append(f"{keyword} (–∞–±–±—Ä: {abbrev_syn})")
                        logger.debug(f"   ‚úÖ üß™ –ù–∞–π–¥–µ–Ω–∞ –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞: {abbrev_syn} ‚Üí {keyword}")
                        break

            # –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∏–Ω–∏–º—É–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            if not matched_keywords:
                logger.debug(f"   ‚ö†Ô∏è –ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ SmartMatcher, –Ω–æ –Ω–∞–π–¥–µ–Ω –ø–æ RSS")
                return {
                    'filter_id': filter_config.get('id'),
                    'filter_name': filter_config.get('name'),
                    'score': 10,
                    'matched_keywords': [],
                    'reasons': ['–ù–∞–π–¥–µ–Ω –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É RSS'],
                    'matched_at': datetime.now().isoformat(),
                    'tender_number': tender.get('number'),
                    'tender_name': tender.get('name'),
                    'tender_price': tender_price,
                    'tender_url': tender.get('url'),
                    'red_flags': detect_red_flags(tender)
                }

            # –®–ê–ì 7: –°–¢–†–û–ì–ò–ô –†–ï–ñ–ò–ú –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
            # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª 5+ —Å–ª–æ–≤, —Ç—Ä–µ–±—É–µ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–∞—Ç—á–∏–Ω–≥–∞
            match_ratio = len(matched_keywords) / total_criteria

            if total_criteria >= self.MIN_KEYWORDS_FOR_STRICT_MODE:
                # –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º: —à—Ç—Ä–∞—Ñ –∑–∞ –º–∞–ª–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (–Ω–æ –Ω–µ –æ—Ç—Å–µ–∫–∞–µ–º!)
                if len(matched_keywords) < self.MIN_MATCHES_ABSOLUTE or match_ratio < self.MIN_MATCH_RATIO_STRICT:
                    penalty = int(score * 0.40)
                    score -= penalty
                    logger.debug(f"   ‚ö†Ô∏è –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º: —à—Ç—Ä–∞—Ñ -{penalty} ({len(matched_keywords)} —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π, {match_ratio:.0%})")
                else:
                    logger.debug(f"   ‚úÖ –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º –ø—Ä–æ–π–¥–µ–Ω: {len(matched_keywords)} —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π ({match_ratio:.0%})")

            # –®–ê–ì 8: –ë–æ–Ω—É—Å/—à—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            # –£–º–µ—Ä–µ–Ω–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã - –Ω–µ —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ, —á—Ç–æ–±—ã –Ω–µ –æ—Ç—Å–µ–∫–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ–Ω–¥–µ—Ä—ã
            if match_ratio < 0.15 and total_criteria >= 5:
                # –®—Ç—Ä–∞—Ñ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–º % —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ò –±–æ–ª—å—à–æ–º —á–∏—Å–ª–µ —Å–ª–æ–≤
                penalty = int(score * 0.25)
                score -= penalty
                logger.debug(f"   ‚ö†Ô∏è –®—Ç—Ä–∞—Ñ –∑–∞ –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–π % —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π ({match_ratio:.0%}): -{penalty}")
            elif match_ratio < 0.25 and total_criteria >= 5:
                # –ù–µ–±–æ–ª—å—à–æ–π —à—Ç—Ä–∞—Ñ –∑–∞ –Ω–∏–∑–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                penalty = int(score * 0.15)
                score -= penalty
                logger.debug(f"   ‚ö†Ô∏è –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–∏–∑–∫–∏–π % —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π ({match_ratio:.0%}): -{penalty}")
            elif match_ratio >= 0.7:
                # –ë–æ–Ω—É—Å –∑–∞ –≤—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                bonus = int(score * 0.2)
                score += bonus
                logger.debug(f"   ‚ú® –ë–æ–Ω—É—Å –∑–∞ –≤—ã—Å–æ–∫–∏–π % —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π ({match_ratio:.0%}): +{bonus}")

        else:
            # –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –±–µ–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None (—Ñ–∏–ª—å—Ç—Ä –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π)
            logger.debug(f"   ‚õî –§–∏–ª—å—Ç—Ä –±–µ–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤")
            return None

        # ============================================
        # 4. –ë–û–ù–£–°–´ –ó–ê –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ö–†–ò–¢–ï–†–ò–ò
        # ============================================

        # –ë–æ–Ω—É—Å –∑–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω–µ (—á–µ–º –±–ª–∏–∂–µ –∫ —Å–µ—Ä–µ–¥–∏–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞, —Ç–µ–º –ª—É—á—à–µ)
        if price_min and price_max and tender_price:
            price_middle = (price_min + price_max) / 2
            price_deviation = abs(tender_price - price_middle) / (price_max - price_min)
            price_bonus = int((1 - price_deviation) * 20)
            score += price_bonus

        # –ë–æ–Ω—É—Å –∑–∞ –Ω–µ–¥–∞–≤–Ω—é—é –ø—É–±–ª–∏–∫–∞—Ü–∏—é
        published_date = tender.get('published_datetime')
        if published_date:
            try:
                if isinstance(published_date, str):
                    pub_dt = datetime.fromisoformat(published_date.replace('Z', '+00:00'))
                else:
                    pub_dt = published_date

                days_old = (datetime.now(pub_dt.tzinfo) - pub_dt).days
                if days_old == 0:
                    score += 10  # –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —Å–µ–≥–æ–¥–Ω—è
                elif days_old <= 3:
                    score += 5  # –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –Ω–µ–¥–∞–≤–Ω–æ
            except:
                pass

        # ============================================
        # 5. FEEDBACK LEARNING (Premium)
        # ============================================

        # –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —à—Ç—Ä–∞—Ñ—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤
        if user_negative_keywords:
            score = self.apply_feedback_penalty(score, tender, user_negative_keywords)

        # ============================================
        # 6. –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø SCORE (0-100)
        # ============================================

        score = min(100, max(0, score))

        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        self.stats['total_matches'] += 1
        if score >= 70:
            self.stats['high_score_matches'] += 1
        elif score >= 50:
            self.stats['medium_score_matches'] += 1
        else:
            self.stats['low_score_matches'] += 1

        logger.info(f"   ‚úÖ MATCH! Score: {score}/100 | –§–∏–ª—å—Ç—Ä: {filter_config.get('name', 'N/A')}")

        # –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ–º –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏
        red_flags = detect_red_flags(tender)
        if red_flags:
            logger.info(f"   üö© –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏: {red_flags}")

        return {
            'filter_id': filter_config.get('id'),
            'filter_name': filter_config.get('name'),
            'score': score,
            'matched_keywords': matched_keywords,
            'reasons': [f'–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ: {kw}' for kw in matched_keywords],
            'matched_at': datetime.now().isoformat(),
            'tender_number': tender.get('number'),
            'tender_name': tender.get('name'),
            'tender_price': tender_price,
            'tender_url': tender.get('url'),
            'red_flags': red_flags
        }

    def match_against_filters(
        self,
        tender: Dict[str, Any],
        filters: List[Dict[str, Any]],
        min_score: int = 75,
        user_negative_keywords: Optional[List[str]] = None
    ) -> List[Dict[str, Any]]:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–Ω–¥–µ—Ä–∞ –ø—Ä–æ—Ç–∏–≤ —Å–ø–∏—Å–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤.

        Args:
            tender: –î–∞–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ—Ä–∞
            filters: –°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            min_score: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

        Returns:
            –°–ø–∏—Å–æ–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ score)
        """
        matches = []

        tender_number = tender.get('number', 'N/A')
        logger.debug(f"\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–Ω–¥–µ—Ä–∞ {tender_number} –ø—Ä–æ—Ç–∏–≤ {len(filters)} —Ñ–∏–ª—å—Ç—Ä–æ–≤...")

        for filter_config in filters:
            match_result = self.match_tender(tender, filter_config, user_negative_keywords)

            if match_result and match_result['score'] >= min_score:
                matches.append(match_result)

        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ score (–æ—Ç –±–æ–ª—å—à–µ–≥–æ –∫ –º–µ–Ω—å—à–µ–º—É)
        matches.sort(key=lambda x: x['score'], reverse=True)

        if matches:
            logger.info(f"   ‚úÖ –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: {len(matches)} (–ª—É—á—à–∏–π score: {matches[0]['score']})")
        else:
            logger.debug(f"   ‚ÑπÔ∏è  –°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")

        return matches

    def batch_match(
        self,
        tenders: List[Dict[str, Any]],
        filters: List[Dict[str, Any]],
        min_score: int = 75
    ) -> Dict[str, List[Dict[str, Any]]]:
        """
        –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤ –ø—Ä–æ—Ç–∏–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤.

        Args:
            tenders: –°–ø–∏—Å–æ–∫ —Ç–µ–Ω–¥–µ—Ä–æ–≤
            filters: –°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            min_score: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score

        Returns:
            –°–ª–æ–≤–∞—Ä—å {tender_number: [matches]}
        """
        logger.info(f"\nüîÑ –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: {len(tenders)} —Ç–µ–Ω–¥–µ—Ä–æ–≤ x {len(filters)} —Ñ–∏–ª—å—Ç—Ä–æ–≤")

        results = {}

        for tender in tenders:
            tender_number = tender.get('number')
            matches = self.match_against_filters(tender, filters, min_score)

            if matches:
                results[tender_number] = matches

        logger.info(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {len(results)} —Ç–µ–Ω–¥–µ—Ä–æ–≤ —Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏ –∏–∑ {len(tenders)}")

        return results

    def get_stats(self) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ matching."""
        return self.stats.copy()

    @staticmethod
    def _parse_json_field(field_value: Any) -> List[str]:
        """–ü–∞—Ä—Å–∏–Ω–≥ JSON –ø–æ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö."""
        if isinstance(field_value, list):
            return field_value
        if isinstance(field_value, str):
            try:
                return json.loads(field_value)
            except:
                return []
        return []


# ============================================
# –ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø
# ============================================

def example_usage():
    """–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Smart Matcher."""
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(levelname)s - %(message)s'
    )

    # –°–æ–∑–¥–∞–µ–º matcher
    matcher = SmartMatcher()

    # –ü—Ä–∏–º–µ—Ä —Ç–µ–Ω–¥–µ—Ä–∞
    tender = {
        'number': '0123456789',
        'name': '–ü–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
        'description': '–ü–æ—Å—Ç–∞–≤–∫–∞ –Ω–æ—É—Ç–±—É–∫–æ–≤ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ –¥–ª—è –æ—Ñ–∏—Å–∞',
        'price': 2500000,
        'region': '–ú–æ—Å–∫–≤–∞',
        'purchase_type': '—Ç–æ–≤–∞—Ä—ã',
        'customer_name': '–û–û–û "–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è"',
        'published_datetime': datetime.now().isoformat()
    }

    # –ü—Ä–∏–º–µ—Ä —Ñ–∏–ª—å—Ç—Ä–∞ (–∫–∞–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
    filter_config = {
        'id': 1,
        'name': 'IT –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ',
        'keywords': json.dumps(['–∫–æ–º–ø—å—é—Ç–µ—Ä', '–Ω–æ—É—Ç–±—É–∫'], ensure_ascii=False),
        'exclude_keywords': json.dumps(['–±/—É', '—Ä–µ–º–æ–Ω—Ç'], ensure_ascii=False),
        'price_min': 1000000,
        'price_max': 5000000,
        'regions': json.dumps(['–ú–æ—Å–∫–≤–∞', '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'], ensure_ascii=False),
        'tender_types': json.dumps(['—Ç–æ–≤–∞—Ä—ã'], ensure_ascii=False)
    }

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    match_result = matcher.match_tender(tender, filter_config)

    if match_result:
        print(f"\n‚úÖ –°–û–í–ü–ê–î–ï–ù–ò–ï!")
        print(f"Score: {match_result['score']}/100")
        print(f"Matched keywords: {', '.join(match_result['matched_keywords'])}")
    else:
        print(f"\n‚ùå –¢–µ–Ω–¥–µ—Ä –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ–¥ —Ñ–∏–ª—å—Ç—Ä")

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    print(f"\n–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ matcher:")
    print(json.dumps(matcher.get_stats(), indent=2, ensure_ascii=False))


if __name__ == '__main__':
    example_usage()
