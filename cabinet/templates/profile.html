<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏ ‚Äî Tender Sniper</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@700;900&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{--bg:#0a0e17;--bg2:#111623;--bg3:#181e2e;--surface:rgba(255,255,255,0.04);--line:rgba(255,255,255,0.07);--gold:#d4a853;--gold-dim:rgba(212,168,83,0.12);--gold-line:rgba(212,168,83,0.25);--white:#f0f0f0;--gray:#6b7a90;--gray2:#99a8b8;--green:#3dd68c;--red:#e74c3c;--sidebar-w:240px}
    body{background:var(--bg);color:var(--white);font-family:'Manrope',system-ui,sans-serif;font-size:15px;line-height:1.55;display:flex;min-height:100vh}
    .sidebar{width:var(--sidebar-w);background:var(--bg2);border-right:1px solid var(--line);padding:24px 16px;display:flex;flex-direction:column;position:fixed;height:100vh}
    .sidebar .logo{font-family:'Unbounded',sans-serif;font-size:16px;font-weight:900;margin-bottom:32px;padding:0 8px}.sidebar .logo span{color:var(--gold)}
    .sidebar nav{flex:1}
    .sidebar a{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:8px;color:var(--gray2);text-decoration:none;font-size:14px;font-weight:500;transition:all 0.15s;margin-bottom:2px}
    .sidebar a:hover{background:var(--surface);color:var(--white)}.sidebar a.active{background:var(--gold-dim);color:var(--gold)}
    .sidebar .icon{width:20px;text-align:center}
    .sidebar .bottom{border-top:1px solid var(--line);padding-top:16px;margin-top:auto}.sidebar .bottom a{color:var(--gray);font-size:13px}
    .main{margin-left:var(--sidebar-w);flex:1;padding:32px 40px;max-width:900px}
    .page-header{margin-bottom:28px}.page-header h1{font-family:'Unbounded',sans-serif;font-size:22px;font-weight:700;margin-bottom:4px}.page-header p{color:var(--gray2);font-size:14px}
    .card{background:var(--bg2);border:1px solid var(--line);border-radius:12px;padding:24px;margin-bottom:16px}
    .card h3{font-size:16px;font-weight:700;margin-bottom:16px}
    .form-group{margin-bottom:16px}.form-group label{display:block;font-size:13px;font-weight:600;color:var(--gray2);margin-bottom:6px}
    .form-group input,.form-group textarea,.form-group select{width:100%;padding:10px 14px;border-radius:8px;background:var(--bg3);border:1px solid var(--line);color:var(--white);font-family:'Manrope',sans-serif;font-size:14px}
    .form-group input:focus,.form-group textarea:focus{outline:none;border-color:var(--gold-line)}
    .form-group textarea{resize:vertical;min-height:80px}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:10px 20px;border-radius:8px;font-family:'Manrope',sans-serif;font-size:14px;font-weight:600;cursor:pointer;border:none;transition:all 0.15s;text-decoration:none}
    .btn-gold{background:var(--gold);color:#0a0e17}.btn-gold:hover{opacity:0.9}
    .loading{text-align:center;padding:40px;color:var(--gray)}
    .spinner{width:32px;height:32px;border:3px solid var(--line);border-top-color:var(--gold);border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 12px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .toast{position:fixed;bottom:24px;right:24px;padding:12px 20px;border-radius:8px;background:var(--bg3);border:1px solid var(--gold-line);color:var(--white);font-size:14px;z-index:1000;opacity:0;transition:opacity 0.3s;pointer-events:none}.toast.show{opacity:1;pointer-events:auto}
    .status-bar{padding:12px 16px;border-radius:8px;margin-bottom:20px;font-size:14px}
    .status-complete{background:rgba(61,214,140,0.1);border:1px solid rgba(61,214,140,0.3);color:var(--green)}
    .status-incomplete{background:rgba(212,168,83,0.1);border:1px solid var(--gold-line);color:var(--gold)}
    .checkbox-group{display:flex;align-items:center;gap:8px}.checkbox-group input[type=checkbox]{width:auto}
    @media(max-width:768px){.sidebar{width:0;overflow:hidden;padding:0}.main{margin-left:0;padding:16px}.form-row,.form-row-3{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="logo">TENDER<span>SNIPER</span></div>
    <nav>
      <a href="/cabinet/"><span class="icon">üìä</span> –¢–µ–Ω–¥–µ—Ä—ã</a>
      <a href="/cabinet/profile" class="active"><span class="icon">üè¢</span> –ü—Ä–æ—Ñ–∏–ª—å</a>
      <a href="/cabinet/documents"><span class="icon">üìÑ</span> –î–æ–∫—É–º–µ–Ω—Ç—ã</a>
      <a href="/cabinet/filters"><span class="icon">üéØ</span> –§–∏–ª—å—Ç—Ä—ã</a>
    </nav>
    <div class="bottom">
      <a href="https://t.me/TenderSniperBot">–ë–æ—Ç –≤ Telegram</a>
      <a href="/cabinet/logout">–í—ã–π—Ç–∏</a>
    </div>
  </aside>

  <main class="main">
    <div class="page-header">
      <h1>–ü—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏</h1>
      <p>–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–Ω–¥–µ—Ä–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
    </div>

    <div id="status-bar"></div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...
    </div>

    <form id="profile-form" style="display:none" onsubmit="saveProfile(event)">
      <div class="card">
        <h3>–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</h3>
        <div class="form-group">
          <label>–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ *</label>
          <input type="text" id="company_name" placeholder="–û–û–û ¬´–†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞¬ª" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</label>
            <input type="text" id="company_name_short" placeholder="–û–û–û ¬´–†–∏–ö¬ª">
          </div>
          <div class="form-group">
            <label>–ü—Ä–∞–≤–æ–≤–∞—è —Ñ–æ—Ä–º–∞</label>
            <select id="legal_form">
              <option value="">‚Äî</option>
              <option value="–û–û–û">–û–û–û</option>
              <option value="–ò–ü">–ò–ü</option>
              <option value="–ê–û">–ê–û</option>
              <option value="–ü–ê–û">–ü–ê–û</option>
              <option value="–ì–£–ü">–ì–£–ü</option>
              <option value="–ú–£–ü">–ú–£–ü</option>
            </select>
          </div>
        </div>
        <div class="form-row-3">
          <div class="form-group">
            <label>–ò–ù–ù *</label>
            <input type="text" id="inn" placeholder="1234567890" required pattern="\d{10}(\d{2})?" title="10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä">
          </div>
          <div class="form-group">
            <label>–ö–ü–ü</label>
            <input type="text" id="kpp" placeholder="123456789" pattern="\d{9}" title="9 —Ü–∏—Ñ—Ä">
          </div>
          <div class="form-group">
            <label>–û–ì–†–ù</label>
            <input type="text" id="ogrn" placeholder="1234567890123" pattern="\d{13}(\d{2})?" title="13 –∏–ª–∏ 15 —Ü–∏—Ñ—Ä">
          </div>
        </div>
      </div>

      <div class="card">
        <h3>–ê–¥—Ä–µ—Å–∞</h3>
        <div class="form-group">
          <label>–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å *</label>
          <input type="text" id="legal_address" required placeholder="123456, –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1">
        </div>
        <div class="form-group">
          <label>–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</label>
          <input type="text" id="actual_address" placeholder="–ï—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ">
        </div>
        <div class="form-group">
          <label>–ü–æ—á—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å</label>
          <input type="text" id="postal_address" placeholder="–ï—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è">
        </div>
      </div>

      <div class="card">
        <h3>–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</h3>
        <div class="form-group">
          <label>–§–ò–û —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è *</label>
          <input type="text" id="director_name" required placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
            <input type="text" id="director_position" placeholder="–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä">
          </div>
          <div class="form-group">
            <label>–î–µ–π—Å—Ç–≤—É–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏</label>
            <input type="text" id="director_basis" placeholder="–£—Å—Ç–∞–≤">
          </div>
        </div>
      </div>

      <div class="card">
        <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
        <div class="form-row">
          <div class="form-group">
            <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
            <input type="tel" id="phone" required placeholder="+7 (495) 123-45-67">
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" id="email" required placeholder="info@company.ru">
          </div>
        </div>
        <div class="form-group">
          <label>–°–∞–π—Ç</label>
          <input type="text" id="website" placeholder="https://company.ru">
        </div>
      </div>

      <div class="card">
        <h3>–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</h3>
        <div class="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞</label>
          <input type="text" id="bank_name" placeholder="–ü–ê–û –°–±–µ—Ä–±–∞–Ω–∫">
        </div>
        <div class="form-row-3">
          <div class="form-group">
            <label>–ë–ò–ö</label>
            <input type="text" id="bank_bik" placeholder="044525225" pattern="\d{9}" title="9 —Ü–∏—Ñ—Ä">
          </div>
          <div class="form-group">
            <label>–†–∞—Å—á—ë—Ç–Ω—ã–π —Å—á—ë—Ç</label>
            <input type="text" id="bank_account" placeholder="40702810..." pattern="\d{20}" title="20 —Ü–∏—Ñ—Ä">
          </div>
          <div class="form-group">
            <label>–ö–æ—Ä—Ä. —Å—á—ë—Ç</label>
            <input type="text" id="bank_corr_account" placeholder="30101810..." pattern="\d{20}" title="20 —Ü–∏—Ñ—Ä">
          </div>
        </div>
      </div>

      <div class="card">
        <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h3>
        <div class="form-group checkbox-group">
          <input type="checkbox" id="smp_status">
          <label for="smp_status" style="margin-bottom:0">–°—É–±—ä–µ–∫—Ç –º–∞–ª–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (–ú–°–ü)</label>
        </div>
        <div class="form-group">
          <label>–õ–∏—Ü–µ–Ω–∑–∏–∏ –∏ –¥–æ–ø—É—Å–∫–∏</label>
          <textarea id="licenses_text" placeholder="–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –∏–º–µ—é—â–∏–µ—Å—è –ª–∏—Ü–µ–Ω–∑–∏–∏"></textarea>
        </div>
        <div class="form-group">
          <label>–û–ø–∏—Å–∞–Ω–∏–µ –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã</label>
          <textarea id="experience_description" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–ø—ã—Ç–∞ –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π"></textarea>
        </div>
      </div>

      <button type="submit" class="btn btn-gold" id="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
    </form>
  </main>

  <div class="toast" id="toast"></div>

  <script>
    function showToast(msg,dur=3000){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),dur)}

    const FIELDS = ['company_name','company_name_short','legal_form','inn','kpp','ogrn',
      'legal_address','actual_address','postal_address',
      'director_name','director_position','director_basis',
      'phone','email','website',
      'bank_name','bank_bik','bank_account','bank_corr_account',
      'licenses_text','experience_description'];

    async function loadProfile() {
      const resp = await fetch('/cabinet/api/profile');
      if (resp.status === 401) { location.href = '/cabinet/login'; return; }
      const data = await resp.json();
      document.getElementById('loading').style.display = 'none';
      document.getElementById('profile-form').style.display = 'block';

      const p = data.profile;
      if (!p) {
        document.getElementById('status-bar').innerHTML = '<div class="status-bar status-incomplete">–ü—Ä–æ—Ñ–∏–ª—å –µ—â—ë –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.</div>';
        return;
      }

      // Fill form
      FIELDS.forEach(f => {
        const el = document.getElementById(f);
        if (el && p[f]) el.value = p[f];
      });
      document.getElementById('smp_status').checked = !!p.smp_status;

      // Status
      const statusHtml = p.is_complete
        ? '<div class="status-bar status-complete">‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω ‚Äî –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∞–∫—Ç–∏–≤–Ω–∞</div>'
        : '<div class="status-bar status-incomplete">‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–æ—Ç–º–µ—á–µ–Ω—ã *) –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</div>';
      document.getElementById('status-bar').innerHTML = statusHtml;
    }

    async function saveProfile(e) {
      e.preventDefault();
      const btn = document.getElementById('save-btn');
      btn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
      btn.disabled = true;

      const data = {};
      FIELDS.forEach(f => {
        const el = document.getElementById(f);
        if (el) data[f] = el.value || null;
      });
      data.smp_status = document.getElementById('smp_status').checked;

      try {
        const resp = await fetch('/cabinet/api/profile', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(data),
        });
        const result = await resp.json();
        if (result.ok) {
          showToast('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
          loadProfile(); // Reload status
        } else {
          showToast(result.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        }
      } catch(e) {
        showToast('–û—à–∏–±–∫–∞: ' + e.message);
      }

      btn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å';
      btn.disabled = false;
    }

    loadProfile();
  </script>
</body>
</html>
