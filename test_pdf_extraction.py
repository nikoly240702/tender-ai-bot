"""–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF."""

import sys
sys.path.append('src')

from document_processor.text_extractor import TextExtractor

# –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
contract_path = "/Users/nikolaichizhik/Desktop/–ü—Ä–∏–º–µ—Ä —Ç–µ–Ω–¥–µ—Ä–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞–º/–ü—Ä–æ–µ–∫—Ç_–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞_16770918-1.pdf"

print("–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞...")
print("="*80)

try:
    result = TextExtractor.extract_text(contract_path)

    print(f"\n–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:")
    print(f"- –§–∞–π–ª: {result['file_name']}")
    print(f"- –°–∏–º–≤–æ–ª–æ–≤: {result['char_count']:,}")
    print(f"- –°–ª–æ–≤: {result['word_count']:,}")
    print("\n" + "="*80)

    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
    full_text = result['text']

    # –ò—â–µ–º —Ä–∞–∑–¥–µ–ª —Å —É—Å–ª–æ–≤–∏—è–º–∏ –æ–ø–ª–∞—Ç—ã
    print("\nüîç –ü–æ–∏—Å–∫ —Ä–∞–∑–¥–µ–ª–∞ '–ü–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—á–µ—Ç–æ–≤' / '–¶–µ–Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞'...")

    # –†–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    keywords = [
        "2.6",
        "–ø–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—á–µ—Ç–æ–≤",
        "—Ü–µ–Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏ –ø–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—á–µ—Ç–æ–≤",
        "—Ä–∞—Å—á–µ—Ç—ã –º–µ–∂–¥—É –∑–∞–∫–∞–∑—á–∏–∫–æ–º",
        "7 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π",
        "7 (—Å–µ–º–∏) —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π"
    ]

    for keyword in keywords:
        if keyword.lower() in full_text.lower():
            # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
            pos = full_text.lower().find(keyword.lower())
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç: 200 —Å–∏–º–≤–æ–ª–æ–≤ –¥–æ –∏ 500 –ø–æ—Å–ª–µ
            start = max(0, pos - 200)
            end = min(len(full_text), pos + 500)
            context = full_text[start:end]

            print(f"\n‚úì –ù–∞–π–¥–µ–Ω–æ: '{keyword}'")
            print(f"–ö–æ–Ω—Ç–µ–∫—Å—Ç:\n{'-'*80}")
            print(context)
            print("-"*80)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –∫–ª—é—á–µ–≤–∞—è —Ñ—Ä–∞–∑–∞ "–Ω–µ –ø–æ–∑–¥–Ω–µ–µ 7 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π"
    if "7" in full_text and "—Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π" in full_text.lower():
        print("\n‚úÖ –ö–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ä–æ–∫–µ –æ–ø–ª–∞—Ç—ã –ù–ê–ô–î–ï–ù–ê –≤ —Ç–µ–∫—Å—Ç–µ")
    else:
        print("\n‚ùå –ö–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ä–æ–∫–µ –æ–ø–ª–∞—Ç—ã –ù–ï –ù–ê–ô–î–ï–ù–ê –≤ —Ç–µ–∫—Å—Ç–µ")

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    with open('/Users/nikolaichizhik/tender-ai-agent/extracted_contract_text.txt', 'w', encoding='utf-8') as f:
        f.write(full_text)
    print(f"\nüìÑ –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: extracted_contract_text.txt")

except Exception as e:
    print(f"\n‚ùå –û—à–∏–±–∫–∞: {e}")
    import traceback
    traceback.print_exc()
