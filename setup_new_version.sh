#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ "–ê–≥–µ–Ω—Ç –ø–æ —Ç–µ–Ω–¥–µ—Ä–∞–º –≤–µ—Ä—Å–∏—è 01.12"
# –Ω–∞ Desktop –≤–∞—à–µ–≥–æ Mac

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ '–ê–≥–µ–Ω—Ç –ø–æ —Ç–µ–Ω–¥–µ—Ä–∞–º –≤–µ—Ä—Å–∏—è 01.12'"
echo "=================================================="
echo ""

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ –Ω–æ–≤–æ–π –ø–∞–ø–∫–µ
NEW_DIR="$HOME/Desktop/–ê–≥–µ–Ω—Ç –ø–æ —Ç–µ–Ω–¥–µ—Ä–∞–º –≤–µ—Ä—Å–∏—è 01.12"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–∞–ø–∫–∞
if [ -d "$NEW_DIR" ]; then
    echo "‚ö†Ô∏è  –ü–∞–ø–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: $NEW_DIR"
    read -p "–£–¥–∞–ª–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å –∑–∞–Ω–æ–≤–æ? (y/n): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –ø–∞–ø–∫—É..."
        rm -rf "$NEW_DIR"
    else
        echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ"
        exit 1
    fi
fi

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É
echo "üìÅ –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É: $NEW_DIR"
mkdir -p "$NEW_DIR"
cd "$NEW_DIR"

# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
echo "üì• –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
git clone https://github.com/nikoly240702/tender-ai-bot.git .

# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ main
echo "üîÄ –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–µ—Ç–∫—É main..."
git checkout main
git pull origin main

# –ü—Ä–æ–≤–µ—Ä—è–µ–º Python
echo ""
echo "üêç –ü—Ä–æ–≤–µ—Ä–∫–∞ Python..."
if command -v python3 &> /dev/null; then
    PYTHON_VERSION=$(python3 --version)
    echo "‚úÖ $PYTHON_VERSION"
else
    echo "‚ùå Python 3 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    echo "   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.11+ —Å https://www.python.org"
    exit 1
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo ""
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
if [ -f "requirements.txt" ]; then
    pip3 install -r requirements.txt
    echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
else
    echo "‚ö†Ô∏è  requirements.txt –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º .env —Ñ–∞–π–ª
echo ""
echo "üîë –ü—Ä–æ–≤–µ—Ä–∫–∞ .env —Ñ–∞–π–ª–∞..."
if [ -f ".env" ]; then
    echo "‚úÖ .env —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω"
    echo ""
    echo "–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:"
    echo "---------------------"
    grep -v "^#" .env | grep -v "^$" | while read line; do
        KEY=$(echo "$line" | cut -d'=' -f1)
        echo "  ‚úì $KEY"
    done
else
    echo "‚ùå .env —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "   –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏"
    exit 1
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã
echo ""
echo "üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã:"
echo "---------------------"
git log --oneline -5

# –ü—Ä–æ–≤–µ—Ä—è–µ–º Railway –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
echo ""
echo "üöÇ Railway –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:"
echo "------------------------"
if [ -f "railway.json" ]; then
    echo "‚úÖ railway.json –Ω–∞–π–¥–µ–Ω"
elif [ -f "railway.toml" ]; then
    echo "‚úÖ railway.toml –Ω–∞–π–¥–µ–Ω"
else
    echo "‚ö†Ô∏è  Railway –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
fi

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
echo ""
echo "=================================================="
echo "‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!"
echo ""
echo "üìÇ –ü—É—Ç—å: $NEW_DIR"
echo ""
echo "üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "  1. –û—Ç–∫—Ä–æ–π—Ç–µ Claude Desktop"
echo "  2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: cd \"$NEW_DIR\""
echo "  3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: claude ."
echo "  4. –°–∫–∞–∂–∏—Ç–µ Claude: '–ü—Ä–æ—á–∏—Ç–∞–π README_CLAUDE_TERMINAL.md'"
echo ""
echo "üí° –¢–µ–ø–µ—Ä—å Claude —Å–º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—É—à–∏—Ç—å –≤ main!"
echo "=================================================="
