# üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç 22.11.2024

**Git Tag:** `v2024.11.22-pdf-fix`
**–ö–æ–º–º–∏—Ç:** `72a41b2`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

---

## üéØ –†–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. üêõ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –ë–∏—Ç—ã–µ PDF –æ—Ç zakupki.gov.ru

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í—Å–µ PDF –ø–∞–¥–∞–ª–∏ —Å –æ—à–∏–±–∫–æ–π "EOF marker not found"
- –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ fallback `strings` –∫–æ—Ç–æ—Ä—ã–π –∏–∑–≤–ª–µ–∫–∞–ª –º—É—Å–æ—Ä
- AI –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –ø–æ—á—Ç–∏ –ø—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç ‚Üí –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ (15 –º–ª–Ω –≤–º–µ—Å—Ç–æ 500 —Ç—ã—Å)

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω **pdftotext** (–±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–π –¥–ª—è –±–∏—Ç—ã—Ö PDF)
- ‚úÖ –£–ª—É—á—à–µ–Ω OCR fallback —á–µ—Ä–µ–∑ tesseract
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ (–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞ –µ—Å–ª–∏ <40% –±—É–∫–≤)

**–§–∞–π–ª—ã:**
- `src/document_processor/text_extractor.py:224-249`
- `Dockerfile:14-17` (poppler-utils, tesseract)

---

### 2. üîç –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
- zakupki.gov.ru –Ω–∞–∑—ã–≤–∞–µ—Ç DOCX —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.pdf`
- –ö–æ–º–∞–Ω–¥–∞ `file` –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ –≤ Docker (–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞)
- –°–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–ª–∞—Å—å –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ DOCX –∫–∞–∫ –∏–∑ PDF

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ **magic bytes** (–Ω–∞–ø—Ä—è–º—É—é –≤ Python)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤:
  - `PK` (ZIP) ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∏ —Å–º–æ—Ç—Ä–∏–º –Ω–∞ `word/` (DOCX) vs `xl/` (XLSX)
  - `%PDF` ‚Üí –Ω–∞—Å—Ç–æ—è—â–∏–π PDF
  - `{\rtf` ‚Üí RTF
  - `D0 CF 11 E0` ‚Üí —Å—Ç–∞—Ä—ã–π DOC

**–§–∞–π–ª—ã:**
- `src/document_processor/text_extractor.py:23-137`
- `Dockerfile:18` (—É—Ç–∏–ª–∏—Ç–∞ file)

---

### 3. üìÑ –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –≤ HTML –æ—Ç—á—ë—Ç–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ–ø–æ–Ω—è—Ç–Ω–æ —Å–∫–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –±—ã–ª–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- –ù–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
- –ù–µ –≤–∏–¥–Ω–æ –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –±–∏—Ç—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (N)"
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞:
  - –ò–º—è —Ñ–∞–π–ª–∞ –∏ —Ç–∏–ø
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤
- ‚úÖ –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è:
  - üü¢ –ó–µ–ª—ë–Ω—ã–π: >100 —Å–ª–æ–≤ (—Ö–æ—Ä–æ—à–æ)
  - üü° –ñ—ë–ª—Ç—ã–π: 10-100 —Å–ª–æ–≤ (–º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö)
  - üî¥ –ö—Ä–∞—Å–Ω—ã–π: <10 —Å–ª–æ–≤ (–≤–µ—Ä–æ—è—Ç–Ω–æ –±–∏—Ç—ã–π —Ñ–∞–π–ª)
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ <10 —Å–ª–æ–≤

**–§–∞–π–ª—ã:**
- `src/reporting/html_template_simple.py:290-336`
- `src/reporting/report_generator.py:195`

---

## üöÄ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ù–æ–≤—ã–π flow –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF:

```
1. PyPDF2 (–±—ã—Å—Ç—Ä–æ)
   ‚Üì FAIL (EOF marker not found)

2. pdftotext (–Ω–∞–¥—ë–∂–Ω–æ –¥–ª—è –±–∏—Ç—ã—Ö PDF) ‚Üê –ù–û–í–û–ï!
   ‚Üì FAIL

3. OCR tesseract (–¥–ª—è —Å–∫–∞–Ω–æ–≤)
   ‚Üì FAIL

4. strings (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π >40% –±—É–∫–≤) ‚Üê –£–õ–£–ß–®–ï–ù–û
   ‚Üì FAIL

5. –û—à–∏–±–∫–∞
```

### Docker –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```dockerfile
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    libxml2-dev \
    libxslt1-dev \
    zlib1g-dev \
    poppler-utils \        # ‚Üê –ù–û–í–û–ï (–¥–ª—è pdftotext)
    tesseract-ocr \        # ‚Üê –ù–û–í–û–ï (–¥–ª—è OCR)
    tesseract-ocr-rus \    # ‚Üê –ù–û–í–û–ï (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
    tesseract-ocr-eng \    # ‚Üê –ù–û–í–û–ï (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫)
    file \                 # ‚Üê –ù–û–í–û–ï (–¥–ª—è MIME —Ç–∏–ø–æ–≤)
    && rm -rf /var/lib/apt/lists/*
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
‚ùå PDF: EOF marker not found
‚ùå Fallback strings: –º—É—Å–æ—Ä (–±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
‚ùå AI –∞–Ω–∞–ª–∏–∑: –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ (15 –º–ª–Ω –≤–º–µ—Å—Ç–æ 500 —Ç—ã—Å)
‚ùå HTML –æ—Ç—á—ë—Ç: –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
‚ùå DOCX –∫–∞–∫ PDF: –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
‚úÖ PDF: pdftotext —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç
‚úÖ DOCX: –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ magic bytes
‚úÖ AI –∞–Ω–∞–ª–∏–∑: –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚úÖ HTML –æ—Ç—á—ë—Ç: —Å–µ–∫—Ü–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è: –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞ –æ—Ç strings
```

---

## üîÑ –î–µ–ø–ª–æ–π

### Railway:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ push –≤ `main`
- –ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∏–∑ Dockerfile
- –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è: 3-5 –º–∏–Ω—É—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –ª—é–±–æ–≥–æ —Ç–µ–Ω–¥–µ—Ä–∞**
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```
   ‚úÖ pdftotext —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ–∫ N —Å–∏–º–≤–æ–ª–æ–≤
   ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ç–∏–ø: docx (–≤–º–µ—Å—Ç–æ pdf –¥–ª—è DOCX —Ñ–∞–π–ª–æ–≤)
   ```
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTML –æ—Ç—á—ë—Ç:**
   - –ï—Å—Ç—å —Å–µ–∫—Ü–∏—è "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã"
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ–∫–∞–∑–∞–Ω–æ –∫–æ–ª-–≤–æ —Å–ª–æ–≤
   - –ù–µ—Ç —Ñ–∞–π–ª–æ–≤ —Å <10 —Å–ª–æ–≤–∞–º–∏ (–∏–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)

---

## üì¶ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **Dockerfile** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è PDF/OCR
2. **src/document_processor/text_extractor.py** - —É–ª—É—á—à–µ–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
3. **src/reporting/html_template_simple.py** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
4. **src/reporting/report_generator.py** - –ø–µ—Ä–µ–¥–∞—á–∞ files_info –≤ —à–∞–±–ª–æ–Ω

---

## üìå –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- [x] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ PDF
- [x] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤
- [x] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
- [x] –ó–∞–ø—É—à–∏—Ç—å –≤ GitHub
- [ ] –î–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–ø–ª–æ—è –Ω–∞ Railway
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑ —Ç–µ–Ω–¥–µ—Ä–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTML –æ—Ç—á—ë—Ç

---

**ü§ñ Generated with [Claude Code](https://claude.com/claude-code)**
