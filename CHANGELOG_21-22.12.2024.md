# Changelog 21-22 –¥–µ–∫–∞–±—Ä—è 2024

## –û–±–∑–æ—Ä
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏–π wizard-—Ñ–ª–æ—É, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–µ–±-–∞–¥–º–∏–Ω–∫–∏.

---

## 21 –¥–µ–∫–∞–±—Ä—è 2024

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### –û—à–∏–±–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Ä–µ–≥–∏–æ–Ω–æ–≤
**–§–∞–π–ª:** `bot/handlers/sniper_wizard_new.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** `AttributeError: 'list' object has no attribute 'items'` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `get_region_keyboard()`

**–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è `get_all_federal_districts()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π, –∞ –Ω–µ —Å–ª–æ–≤–∞—Ä—å.

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—è —Å `for fd_code, fd_name in federal_districts.items()` –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ø–∏—Å–∫–∞.

---

### ‚ú® –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞
**–§–∞–π–ª:** `bot/handlers/sniper_wizard_new.py`

–î–æ–±–∞–≤–ª–µ–Ω 7-–π —à–∞–≥ –≤ wizard —Å –¥–≤—É–º—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–Ω–¥–µ—Ä–æ–≤** (10 / 25 / 50 / 100)
   - –ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM: `select_search_limit`
   - –ù–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞: `get_search_limit_keyboard()`
   - –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞: `SEARCH_LIMITS = [10, 25, 50, 100]`

2. **–ê–≤—Ç–æ–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (–î–∞ / –ù–µ—Ç)
   - –ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM: `select_automonitor`
   - –ù–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞: `get_automonitor_keyboard()`
   - –ï—Å–ª–∏ "–ù–µ—Ç" - —Ñ–∏–ª—å—Ç—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å `is_active=False`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–º–µ—Ä–∞—Ü–∏–∏:** –í—Å–µ —à–∞–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å X/6 –Ω–∞ X/8.

---

### üîç –£–ª—É—á—à–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞

**–§–∞–π–ª:** `tender_sniper/instant_search.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** RSS API zakupki.gov.ru –≤–æ–∑–≤—Ä–∞—â–∞–ª –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ–Ω–¥–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –±–µ–ª—å—ë" –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –º–µ–±–µ–ª–∏).

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º:

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –≤ —Ç–µ–∫—Å—Ç–µ —Ç–µ–Ω–¥–µ—Ä–∞
keyword_found = False
for keyword in original_keywords:
    kw_lower = keyword.lower()
    if len(kw_lower) <= 3:
        pattern = r'\b' + re.escape(kw_lower) + r'\b'
    else:
        pattern = r'\b' + re.escape(kw_lower[:min(len(kw_lower), 5)])
    if re.search(pattern, tender_text, re.IGNORECASE):
        keyword_found = True
        break
```

---

## 22 –¥–µ–∫–∞–±—Ä—è 2024

### üÜï FastAPI Admin Dashboard

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- `tender_sniper/admin/app.py` - –û—Å–Ω–æ–≤–Ω–æ–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `tender_sniper/admin/__init__.py` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è
- `tender_sniper/admin/templates/base.html` - –ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω Bootstrap 5
- `tender_sniper/admin/templates/dashboard.html` - –î–∞—à–±–æ—Ä–¥ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- `tender_sniper/admin/templates/users.html` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `tender_sniper/admin/templates/filters.html` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- `tender_sniper/admin/templates/notifications.html` - –ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `tender_sniper/admin/templates/error.html` - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—à–∏–±–æ–∫
- `tender_sniper/admin/static/.gitkeep` - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- `scripts/run_admin.py` - –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –∞–¥–º–∏–Ω–∫–∏
- `start_admin.sh` - Shell-—Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
- `~/Desktop/Tender Admin.command` - –Ø—Ä–ª—ã–∫ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∞–¥–º–∏–Ω–∫–∏:

**üìä –î–∞—à–±–æ—Ä–¥ (`/`):**
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–∑–∞ 24—á)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º (Free/Basic/Premium)
- –ì—Ä–∞—Ñ–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–ø–æ —á–∞—Å–∞–º –∏ –¥–Ω—è–º)
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã

**üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (`/users`):**
- –°–ø–∏—Å–æ–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- –ü–æ–∏—Å–∫ –ø–æ ID/–∏–º–µ–Ω–∏
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∞—Ä–∏—Ñ—É
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞ (Free ‚Üí Basic ‚Üí Premium)
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**üîç –§–∏–ª—å—Ç—Ä—ã (`/filters`):**
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É (–∞–∫—Ç–∏–≤–Ω—ã–µ/–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ)
- –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤

**üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (`/notifications`):**
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–Ω–¥–µ—Ä–∞
- –°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞)

**üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
- HTTP Basic Auth
- –õ–æ–≥–∏–Ω: `admin`
- –ü–∞—Ä–æ–ª—å: `tender2024`

**üì° API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `GET /api/stats/hourly` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∞—Å–∞–º
- `GET /api/stats/daily` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º
- `GET /health` - Health check

---

### üõ† –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ database.py

**–§–∞–π–ª:** `database.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ `Invalid argument(s) 'pool_size','max_overflow'` –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ SQLite.

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è SQLite –∏ PostgreSQL:

```python
if is_sqlite:
    _engine = create_async_engine(
        database_url,
        echo=echo,
        poolclass=NullPool,
    )
else:
    _engine = create_async_engine(
        database_url,
        echo=echo,
        pool_pre_ping=True,
        pool_size=20,
        max_overflow=40,
    )
```

---

### üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `.env`:**
```
DATABASE_URL=postgresql+asyncpg://postgres:***@mainline.proxy.rlwy.net:57687/railway
```

---

## –ó–∞–ø—É—Å–∫ –∞–¥–º–∏–Ω–∫–∏

**–ß–µ—Ä–µ–∑ —è—Ä–ª—ã–∫:**
–î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ `Tender Admin.command` –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ.

**–ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª:**
```bash
cd ~/Desktop/–ê–≥–µ–Ω—Ç\ 02.12
./start_admin.sh
```

**–î–æ—Å—Ç—É–ø:**
- URL: http://localhost:8080
- –õ–æ–≥–∏–Ω: admin / tender2024

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```
–ê–≥–µ–Ω—Ç 02.12/
‚îú‚îÄ‚îÄ bot/handlers/
‚îÇ   ‚îî‚îÄ‚îÄ sniper_wizard_new.py      # –®–∞–≥ 7, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–æ–≤
‚îú‚îÄ‚îÄ tender_sniper/
‚îÇ   ‚îú‚îÄ‚îÄ instant_search.py          # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.py                 # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.html
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.html
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.html
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filters.html
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notifications.html
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ error.html
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ static/
‚îú‚îÄ‚îÄ database.py                    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SQLite/PostgreSQL
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ run_admin.py
‚îú‚îÄ‚îÄ start_admin.sh
‚îú‚îÄ‚îÄ .env                           # DATABASE_URL
‚îî‚îÄ‚îÄ CHANGELOG_21-22.12.2024.md     # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```
